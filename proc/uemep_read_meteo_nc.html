<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="Air quality dispersion model for high resolution downscaling of EMEP-MSC-W">
    <meta name="author" content="Norwegian Meteorological Institute" >
    <link rel="icon" href="../favicon.png">

    <title>uEMEP_read_meteo_nc &ndash; uEMEP</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
      <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">uEMEP <small>7.0.2</small></a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="../page/index.html">Documentation</a></li>
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../program/uemep.html">Program</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>uEMEP_read_meteo_nc
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title=" 2.5% of total for procedures.">494 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/uEMEP_read_meteo_nc.f90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/uemep_read_meteo_nc.f90.html'>uEMEP_read_meteo_nc.f90</a></li>
                <li class="breadcrumb-item"><a href='../module/read_meteo_nc.html'>read_meteo_nc</a></li>
            <li class="breadcrumb-item active" aria-current="page">uEMEP_read_meteo_nc</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    $(function () {
    $('[data-bs-toggle="tooltip"]').tooltip()
    })
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/uemep_read_meteo_nc.html#src">uEMEP_read_meteo_nc</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>public  subroutine uEMEP_read_meteo_nc()  
</h2>
    



    <h3>Arguments</h3>
    <em>None</em>
    <br>
    <br>
    <div class="card">
      <div class="card-header">
  <h3 class="card-title">Calls</h3>
      </div>
      <div class="card-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proc~~uemep_read_meteo_nc~~CallsGraph Pages: 1 -->
<svg id="procuemep_read_meteo_ncCallsGraph" width="568pt" height="746pt"
 viewBox="0.00 0.00 568.00 746.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~uemep_read_meteo_nc~~CallsGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 742)">
<title>proc~~uemep_read_meteo_nc~~CallsGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-742 564,-742 564,4 -4,4"/>
<!-- proc~uemep_read_meteo_nc -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node1" class="node">
<title>proc~uemep_read_meteo_nc</title>
<polygon fill="none" stroke="black" points="135,-423 0,-423 0,-399 135,-399 135,-423"/>
<text text-anchor="middle" x="67.5" y="-408.6" font-family="Helvetica,sans-Serif" font-size="10.50">uEMEP_read_meteo_nc</text>
</g>
<!-- nf90_close -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node2" class="node">
<title>nf90_close</title>
<polygon fill="#777777" stroke="#777777" points="276.5,-738 206.5,-738 206.5,-714 276.5,-714 276.5,-738"/>
<text text-anchor="middle" x="241.5" y="-723.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">nf90_close</text>
</g>
<!-- proc~uemep_read_meteo_nc&#45;&gt;nf90_close -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge1" class="edge">
<title>proc~uemep_read_meteo_nc&#45;&gt;nf90_close</title>
<path fill="none" stroke="#000000" d="M68.98,-423.12C71.42,-467.59 85.94,-623.44 171,-705 178.09,-711.8 187.3,-716.4 196.69,-719.52"/>
<polygon fill="#000000" stroke="#000000" points="195.88,-722.93 206.46,-722.26 197.77,-716.19 195.88,-722.93"/>
</g>
<!-- nf90_get_att -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node3" class="node">
<title>nf90_get_att</title>
<polygon fill="#777777" stroke="#777777" points="281,-696 202,-696 202,-672 281,-672 281,-696"/>
<text text-anchor="middle" x="241.5" y="-681.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">nf90_get_att</text>
</g>
<!-- proc~uemep_read_meteo_nc&#45;&gt;nf90_get_att -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge2" class="edge">
<title>proc~uemep_read_meteo_nc&#45;&gt;nf90_get_att</title>
<path fill="none" stroke="#000000" d="M69.77,-423.06C74.66,-463.35 95.94,-594.61 171,-663 177.03,-668.49 184.45,-672.55 192.17,-675.55"/>
<polygon fill="#000000" stroke="#000000" points="191.08,-678.87 201.67,-678.7 193.28,-672.23 191.08,-678.87"/>
</g>
<!-- nf90_get_var -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node4" class="node">
<title>nf90_get_var</title>
<polygon fill="#777777" stroke="#777777" points="282.5,-654 200.5,-654 200.5,-630 282.5,-630 282.5,-654"/>
<text text-anchor="middle" x="241.5" y="-639.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">nf90_get_var</text>
</g>
<!-- proc~uemep_read_meteo_nc&#45;&gt;nf90_get_var -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge3" class="edge">
<title>proc~uemep_read_meteo_nc&#45;&gt;nf90_get_var</title>
<path fill="none" stroke="#000000" d="M70.85,-423.04C78.45,-458.84 105.81,-565.52 171,-621 176.68,-625.83 183.44,-629.55 190.48,-632.41"/>
<polygon fill="#000000" stroke="#000000" points="189.59,-635.81 200.18,-635.81 191.9,-629.2 189.59,-635.81"/>
</g>
<!-- nf90_inq_dimid -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node5" class="node">
<title>nf90_inq_dimid</title>
<polygon fill="#777777" stroke="#777777" points="288.5,-612 194.5,-612 194.5,-588 288.5,-588 288.5,-612"/>
<text text-anchor="middle" x="241.5" y="-597.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">nf90_inq_dimid</text>
</g>
<!-- proc~uemep_read_meteo_nc&#45;&gt;nf90_inq_dimid -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge4" class="edge">
<title>proc~uemep_read_meteo_nc&#45;&gt;nf90_inq_dimid</title>
<path fill="none" stroke="#000000" d="M72.49,-423.24C83.19,-454.2 115.59,-536.16 171,-579 175.3,-582.33 180.12,-585.13 185.17,-587.48"/>
<polygon fill="#000000" stroke="#000000" points="183.86,-590.73 194.44,-591.27 186.51,-584.25 183.86,-590.73"/>
</g>
<!-- nf90_inq_varid -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node6" class="node">
<title>nf90_inq_varid</title>
<polygon fill="#777777" stroke="#777777" points="287,-570 196,-570 196,-546 287,-546 287,-570"/>
<text text-anchor="middle" x="241.5" y="-555.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">nf90_inq_varid</text>
</g>
<!-- proc~uemep_read_meteo_nc&#45;&gt;nf90_inq_varid -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge5" class="edge">
<title>proc~uemep_read_meteo_nc&#45;&gt;nf90_inq_varid</title>
<path fill="none" stroke="#000000" d="M74.97,-423.06C89.03,-448.13 124.86,-506.06 171,-537 175.65,-540.11 180.77,-542.78 186.06,-545.06"/>
<polygon fill="#000000" stroke="#000000" points="185.13,-548.45 195.72,-548.76 187.63,-541.91 185.13,-548.45"/>
</g>
<!-- nf90_inquire_dimension -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node7" class="node">
<title>nf90_inquire_dimension</title>
<polygon fill="#777777" stroke="#777777" points="311,-528 172,-528 172,-504 311,-504 311,-528"/>
<text text-anchor="middle" x="241.5" y="-513.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">nf90_inquire_dimension</text>
</g>
<!-- proc~uemep_read_meteo_nc&#45;&gt;nf90_inquire_dimension -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge6" class="edge">
<title>proc~uemep_read_meteo_nc&#45;&gt;nf90_inquire_dimension</title>
<path fill="none" stroke="#000000" d="M79.98,-423.06C97.83,-441.15 134.05,-475.29 171,-495 174.53,-496.88 178.25,-498.62 182.06,-500.22"/>
<polygon fill="#000000" stroke="#000000" points="181.07,-503.59 191.66,-503.92 183.59,-497.06 181.07,-503.59"/>
</g>
<!-- nf90_inquire_variable -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node8" class="node">
<title>nf90_inquire_variable</title>
<polygon fill="#777777" stroke="#777777" points="305,-486 178,-486 178,-462 305,-462 305,-486"/>
<text text-anchor="middle" x="241.5" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">nf90_inquire_variable</text>
</g>
<!-- proc~uemep_read_meteo_nc&#45;&gt;nf90_inquire_variable -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge7" class="edge">
<title>proc~uemep_read_meteo_nc&#45;&gt;nf90_inquire_variable</title>
<path fill="none" stroke="#000000" d="M96.07,-423.13C116.54,-431.94 145.27,-443.86 171,-453 176.63,-455 182.56,-456.98 188.48,-458.88"/>
<polygon fill="#000000" stroke="#000000" points="187.8,-462.33 198.39,-461.98 189.9,-455.65 187.8,-462.33"/>
</g>
<!-- nf90_open -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node9" class="node">
<title>nf90_open</title>
<polygon fill="#777777" stroke="#777777" points="276,-444 207,-444 207,-420 276,-420 276,-444"/>
<text text-anchor="middle" x="241.5" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">nf90_open</text>
</g>
<!-- proc~uemep_read_meteo_nc&#45;&gt;nf90_open -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge8" class="edge">
<title>proc~uemep_read_meteo_nc&#45;&gt;nf90_open</title>
<path fill="none" stroke="#000000" d="M135.49,-419.18C156.03,-421.69 178.08,-424.38 196.65,-426.65"/>
<polygon fill="#000000" stroke="#000000" points="196.23,-430.12 206.58,-427.86 197.08,-423.17 196.23,-430.12"/>
</g>
<!-- proc~date_to_datestr_bracket -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node10" class="node">
<title>proc~date_to_datestr_bracket</title>
<g id="a_proc~~uemep_read_meteo_nc~~CallsGraph_node10"><a xlink:href="../proc/date_to_datestr_bracket.html" xlink:title="date_to_datestr_bracket">
<polygon fill="#d9534f" stroke="#d9534f" points="312,-402 171,-402 171,-378 312,-378 312,-402"/>
<text text-anchor="middle" x="241.5" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">date_to_datestr_bracket</text>
</a>
</g>
</g>
<!-- proc~uemep_read_meteo_nc&#45;&gt;proc~date_to_datestr_bracket -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge9" class="edge">
<title>proc~uemep_read_meteo_nc&#45;&gt;proc~date_to_datestr_bracket</title>
<path fill="none" stroke="#000000" d="M135.49,-402.82C143.74,-401.81 152.23,-400.78 160.65,-399.75"/>
<polygon fill="#000000" stroke="#000000" points="161.35,-403.19 170.85,-398.5 160.5,-396.24 161.35,-403.19"/>
</g>
<!-- proc~date_to_number -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node11" class="node">
<title>proc~date_to_number</title>
<g id="a_proc~~uemep_read_meteo_nc~~CallsGraph_node11"><a xlink:href="../proc/date_to_number.html" xlink:title="date_to_number">
<polygon fill="#d94e8f" stroke="#d94e8f" points="291.5,-360 191.5,-360 191.5,-336 291.5,-336 291.5,-360"/>
<text text-anchor="middle" x="241.5" y="-345.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">date_to_number</text>
</a>
</g>
</g>
<!-- proc~uemep_read_meteo_nc&#45;&gt;proc~date_to_number -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge10" class="edge">
<title>proc~uemep_read_meteo_nc&#45;&gt;proc~date_to_number</title>
<path fill="none" stroke="#000000" d="M96.07,-398.87C116.54,-390.06 145.27,-378.14 171,-369 176.63,-367 182.56,-365.02 188.48,-363.12"/>
<polygon fill="#000000" stroke="#000000" points="189.9,-366.35 198.39,-360.02 187.8,-359.67 189.9,-366.35"/>
</g>
<!-- proc~datestr_to_date -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node12" class="node">
<title>proc~datestr_to_date</title>
<g id="a_proc~~uemep_read_meteo_nc~~CallsGraph_node12"><a xlink:href="../proc/datestr_to_date.html" xlink:title="datestr_to_date">
<polygon fill="#d9534f" stroke="#d9534f" points="289,-318 194,-318 194,-294 289,-294 289,-318"/>
<text text-anchor="middle" x="241.5" y="-303.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">datestr_to_date</text>
</a>
</g>
</g>
<!-- proc~uemep_read_meteo_nc&#45;&gt;proc~datestr_to_date -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge11" class="edge">
<title>proc~uemep_read_meteo_nc&#45;&gt;proc~datestr_to_date</title>
<path fill="none" stroke="#000000" d="M79.98,-398.94C97.83,-380.85 134.05,-346.71 171,-327 175.23,-324.75 179.73,-322.7 184.33,-320.85"/>
<polygon fill="#000000" stroke="#000000" points="185.71,-324.07 193.87,-317.31 183.28,-317.5 185.71,-324.07"/>
</g>
<!-- proc~lb2lambert2_uemep -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node13" class="node">
<title>proc~lb2lambert2_uemep</title>
<g id="a_proc~~uemep_read_meteo_nc~~CallsGraph_node13"><a xlink:href="../proc/lb2lambert2_uemep.html" xlink:title="lb2lambert2_uEMEP">
<polygon fill="#d9534f" stroke="#d9534f" points="300.5,-276 182.5,-276 182.5,-252 300.5,-252 300.5,-276"/>
<text text-anchor="middle" x="241.5" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lb2lambert2_uEMEP</text>
</a>
</g>
</g>
<!-- proc~uemep_read_meteo_nc&#45;&gt;proc~lb2lambert2_uemep -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge12" class="edge">
<title>proc~uemep_read_meteo_nc&#45;&gt;proc~lb2lambert2_uemep</title>
<path fill="none" stroke="#000000" d="M74.97,-398.94C89.03,-373.87 124.86,-315.94 171,-285 173.54,-283.3 176.21,-281.73 178.98,-280.29"/>
<polygon fill="#000000" stroke="#000000" points="180.47,-283.46 188.09,-276.09 177.54,-277.1 180.47,-283.46"/>
</g>
<!-- proc~ll2ps_spherical -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node14" class="node">
<title>proc~ll2ps_spherical</title>
<g id="a_proc~~uemep_read_meteo_nc~~CallsGraph_node14"><a xlink:href="../proc/ll2ps_spherical.html" xlink:title="LL2PS_spherical">
<polygon fill="#d9534f" stroke="#d9534f" points="290.5,-234 192.5,-234 192.5,-210 290.5,-210 290.5,-234"/>
<text text-anchor="middle" x="241.5" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">LL2PS_spherical</text>
</a>
</g>
</g>
<!-- proc~uemep_read_meteo_nc&#45;&gt;proc~ll2ps_spherical -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge13" class="edge">
<title>proc~uemep_read_meteo_nc&#45;&gt;proc~ll2ps_spherical</title>
<path fill="none" stroke="#000000" d="M72.49,-398.76C83.19,-367.8 115.59,-285.84 171,-243 174.63,-240.19 178.64,-237.76 182.84,-235.65"/>
<polygon fill="#000000" stroke="#000000" points="184.5,-238.74 192.27,-231.53 181.7,-232.32 184.5,-238.74"/>
</g>
<!-- proc~number_to_date -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node15" class="node">
<title>proc~number_to_date</title>
<g id="a_proc~~uemep_read_meteo_nc~~CallsGraph_node15"><a xlink:href="../proc/number_to_date.html" xlink:title="number_to_date">
<polygon fill="#d9534f" stroke="#d9534f" points="291.5,-192 191.5,-192 191.5,-168 291.5,-168 291.5,-192"/>
<text text-anchor="middle" x="241.5" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">number_to_date</text>
</a>
</g>
</g>
<!-- proc~uemep_read_meteo_nc&#45;&gt;proc~number_to_date -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge14" class="edge">
<title>proc~uemep_read_meteo_nc&#45;&gt;proc~number_to_date</title>
<path fill="none" stroke="#000000" d="M70.85,-398.96C78.45,-363.16 105.81,-256.48 171,-201 174.29,-198.2 177.95,-195.77 181.82,-193.66"/>
<polygon fill="#000000" stroke="#000000" points="183.56,-196.71 191.15,-189.32 180.61,-190.37 183.56,-196.71"/>
</g>
<!-- proc~proj2ll -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node16" class="node">
<title>proc~proj2ll</title>
<g id="a_proc~~uemep_read_meteo_nc~~CallsGraph_node16"><a xlink:href="../proc/proj2ll.html" xlink:title="PROJ2LL">
<polygon fill="#d9534f" stroke="#d9534f" points="269.5,-150 213.5,-150 213.5,-126 269.5,-126 269.5,-150"/>
<text text-anchor="middle" x="241.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">PROJ2LL</text>
</a>
</g>
</g>
<!-- proc~uemep_read_meteo_nc&#45;&gt;proc~proj2ll -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge15" class="edge">
<title>proc~uemep_read_meteo_nc&#45;&gt;proc~proj2ll</title>
<path fill="none" stroke="#000000" d="M69.77,-398.94C74.66,-358.65 95.94,-227.39 171,-159 179.94,-150.86 191.93,-145.87 203.44,-142.81"/>
<polygon fill="#000000" stroke="#000000" points="204.34,-146.2 213.34,-140.6 202.81,-139.37 204.34,-146.2"/>
</g>
<!-- proc~replace_string_char -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node17" class="node">
<title>proc~replace_string_char</title>
<g id="a_proc~~uemep_read_meteo_nc~~CallsGraph_node17"><a xlink:href="../proc/replace_string_char.html" xlink:title="replace_string_char">
<polygon fill="#d94e8f" stroke="#d94e8f" points="300,-108 183,-108 183,-84 300,-84 300,-108"/>
<text text-anchor="middle" x="241.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">replace_string_char</text>
</a>
</g>
</g>
<!-- proc~uemep_read_meteo_nc&#45;&gt;proc~replace_string_char -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge16" class="edge">
<title>proc~uemep_read_meteo_nc&#45;&gt;proc~replace_string_char</title>
<path fill="none" stroke="#000000" d="M68.98,-398.88C71.42,-354.41 85.94,-198.56 171,-117 172.14,-115.91 173.33,-114.88 174.57,-113.89"/>
<polygon fill="#000000" stroke="#000000" points="176.87,-116.57 183.33,-108.17 173.05,-110.71 176.87,-116.57"/>
</g>
<!-- proc~date_to_datestr_new -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node19" class="node">
<title>proc~date_to_datestr_new</title>
<g id="a_proc~~uemep_read_meteo_nc~~CallsGraph_node19"><a xlink:href="../proc/date_to_datestr_new.html" xlink:title="date_to_datestr_new">
<polygon fill="#d9534f" stroke="#d9534f" points="470,-402 348,-402 348,-378 470,-378 470,-402"/>
<text text-anchor="middle" x="409" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">date_to_datestr_new</text>
</a>
</g>
</g>
<!-- proc~date_to_datestr_bracket&#45;&gt;proc~date_to_datestr_new -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge17" class="edge">
<title>proc~date_to_datestr_bracket&#45;&gt;proc~date_to_datestr_new</title>
<path fill="none" stroke="#000000" d="M312.21,-390C320.62,-390 329.22,-390 337.65,-390"/>
<polygon fill="#000000" stroke="#000000" points="337.81,-393.5 347.81,-390 337.81,-386.5 337.81,-393.5"/>
</g>
<!-- sngl -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node26" class="node">
<title>sngl</title>
<polygon fill="#777777" stroke="#777777" points="436,-360 382,-360 382,-336 436,-336 436,-360"/>
<text text-anchor="middle" x="409" y="-345.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">sngl</text>
</g>
<!-- proc~date_to_number&#45;&gt;sngl -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge18" class="edge">
<title>proc~date_to_number&#45;&gt;sngl</title>
<path fill="none" stroke="#000000" d="M291.71,-348C317.32,-348 348.1,-348 371.55,-348"/>
<polygon fill="#000000" stroke="#000000" points="371.77,-351.5 381.77,-348 371.77,-344.5 371.77,-351.5"/>
</g>
<!-- idint -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node18" class="node">
<title>idint</title>
<polygon fill="#777777" stroke="#777777" points="436,-276 382,-276 382,-252 436,-252 436,-276"/>
<text text-anchor="middle" x="409" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">idint</text>
</g>
<!-- proc~number_to_date&#45;&gt;idint -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge19" class="edge">
<title>proc~number_to_date&#45;&gt;idint</title>
<path fill="none" stroke="#000000" d="M291.56,-190.95C298.72,-193.63 305.77,-196.94 312,-201 332.59,-214.43 327.7,-229.13 348,-243 355.27,-247.97 363.84,-251.88 372.18,-254.91"/>
<polygon fill="#000000" stroke="#000000" points="371.2,-258.27 381.79,-258.07 373.39,-251.62 371.2,-258.27"/>
</g>
<!-- proc~laea2ll -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node20" class="node">
<title>proc~laea2ll</title>
<g id="a_proc~~uemep_read_meteo_nc~~CallsGraph_node20"><a xlink:href="../proc/laea2ll.html" xlink:title="LAEA2LL">
<polygon fill="#d9534f" stroke="#d9534f" points="438.5,-108 379.5,-108 379.5,-84 438.5,-84 438.5,-108"/>
<text text-anchor="middle" x="409" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">LAEA2LL</text>
</a>
</g>
</g>
<!-- proc~proj2ll&#45;&gt;proc~laea2ll -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge20" class="edge">
<title>proc~proj2ll&#45;&gt;proc~laea2ll</title>
<path fill="none" stroke="#000000" d="M269.83,-131.06C296.97,-124.18 338.82,-113.56 369.36,-105.81"/>
<polygon fill="#000000" stroke="#000000" points="370.41,-109.15 379.24,-103.3 368.69,-102.37 370.41,-109.15"/>
</g>
<!-- proc~lambert2lb2_uemep -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node21" class="node">
<title>proc~lambert2lb2_uemep</title>
<g id="a_proc~~uemep_read_meteo_nc~~CallsGraph_node21"><a xlink:href="../proc/lambert2lb2_uemep.html" xlink:title="lambert2lb2_uEMEP">
<polygon fill="#d9534f" stroke="#d9534f" points="468,-66 350,-66 350,-42 468,-42 468,-66"/>
<text text-anchor="middle" x="409" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lambert2lb2_uEMEP</text>
</a>
</g>
</g>
<!-- proc~proj2ll&#45;&gt;proc~lambert2lb2_uemep -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge21" class="edge">
<title>proc~proj2ll&#45;&gt;proc~lambert2lb2_uemep</title>
<path fill="none" stroke="#000000" d="M269.78,-133.51C283.27,-130.39 299.33,-125.26 312,-117 332.59,-103.57 327.7,-88.87 348,-75 350.39,-73.37 352.92,-71.85 355.54,-70.43"/>
<polygon fill="#000000" stroke="#000000" points="357.2,-73.52 364.7,-66.04 354.17,-67.21 357.2,-73.52"/>
</g>
<!-- proc~ltm2ll -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node22" class="node">
<title>proc~ltm2ll</title>
<g id="a_proc~~uemep_read_meteo_nc~~CallsGraph_node22"><a xlink:href="../proc/ltm2ll.html" xlink:title="ltm2ll">
<polygon fill="#d9534f" stroke="#d9534f" points="436,-234 382,-234 382,-210 436,-210 436,-234"/>
<text text-anchor="middle" x="409" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ltm2ll</text>
</a>
</g>
</g>
<!-- proc~proj2ll&#45;&gt;proc~ltm2ll -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge22" class="edge">
<title>proc~proj2ll&#45;&gt;proc~ltm2ll</title>
<path fill="none" stroke="#000000" d="M269.78,-142.49C283.27,-145.61 299.33,-150.74 312,-159 332.59,-172.43 327.7,-187.13 348,-201 355.27,-205.97 363.84,-209.88 372.18,-212.91"/>
<polygon fill="#000000" stroke="#000000" points="371.2,-216.27 381.79,-216.07 373.39,-209.62 371.2,-216.27"/>
</g>
<!-- proc~ps2ll_spherical -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node23" class="node">
<title>proc~ps2ll_spherical</title>
<g id="a_proc~~uemep_read_meteo_nc~~CallsGraph_node23"><a xlink:href="../proc/ps2ll_spherical.html" xlink:title="PS2LL_spherical">
<polygon fill="#d9534f" stroke="#d9534f" points="458,-192 360,-192 360,-168 458,-168 458,-192"/>
<text text-anchor="middle" x="409" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">PS2LL_spherical</text>
</a>
</g>
</g>
<!-- proc~proj2ll&#45;&gt;proc~ps2ll_spherical -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge23" class="edge">
<title>proc~proj2ll&#45;&gt;proc~ps2ll_spherical</title>
<path fill="none" stroke="#000000" d="M269.83,-144.94C291.74,-150.5 323.25,-158.49 350.65,-165.45"/>
<polygon fill="#000000" stroke="#000000" points="349.98,-168.89 360.53,-167.95 351.7,-162.1 349.98,-168.89"/>
</g>
<!-- proc~rdm2ll -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node24" class="node">
<title>proc~rdm2ll</title>
<g id="a_proc~~uemep_read_meteo_nc~~CallsGraph_node24"><a xlink:href="../proc/rdm2ll.html" xlink:title="RDM2LL">
<polygon fill="#d9534f" stroke="#d9534f" points="437,-150 381,-150 381,-126 437,-126 437,-150"/>
<text text-anchor="middle" x="409" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">RDM2LL</text>
</a>
</g>
</g>
<!-- proc~proj2ll&#45;&gt;proc~rdm2ll -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge24" class="edge">
<title>proc~proj2ll&#45;&gt;proc~rdm2ll</title>
<path fill="none" stroke="#000000" d="M269.83,-138C297.34,-138 339.98,-138 370.61,-138"/>
<polygon fill="#000000" stroke="#000000" points="370.91,-141.5 380.91,-138 370.91,-134.5 370.91,-141.5"/>
</g>
<!-- proc~utm2ll -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node25" class="node">
<title>proc~utm2ll</title>
<g id="a_proc~~uemep_read_meteo_nc~~CallsGraph_node25"><a xlink:href="../proc/utm2ll.html" xlink:title="utm2ll">
<polygon fill="#d9534f" stroke="#d9534f" points="436,-24 382,-24 382,0 436,0 436,-24"/>
<text text-anchor="middle" x="409" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">utm2ll</text>
</a>
</g>
</g>
<!-- proc~proj2ll&#45;&gt;proc~utm2ll -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge25" class="edge">
<title>proc~proj2ll&#45;&gt;proc~utm2ll</title>
<path fill="none" stroke="#000000" d="M269.59,-135.32C283.68,-132.67 300.35,-127.42 312,-117 342.28,-89.92 318.32,-60.72 348,-33 354.74,-26.71 363.47,-22.28 372.18,-19.18"/>
<polygon fill="#000000" stroke="#000000" points="373.35,-22.48 381.89,-16.21 371.3,-15.79 373.35,-22.48"/>
</g>
<!-- dcos -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node27" class="node">
<title>dcos</title>
<polygon fill="#777777" stroke="#777777" points="560,-218 506,-218 506,-194 560,-194 560,-218"/>
<text text-anchor="middle" x="533" y="-203.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dcos</text>
</g>
<!-- proc~ltm2ll&#45;&gt;dcos -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge26" class="edge">
<title>proc~ltm2ll&#45;&gt;dcos</title>
<path fill="none" stroke="#000000" d="M436.17,-218.57C453.54,-216.29 476.57,-213.27 495.7,-210.76"/>
<polygon fill="#000000" stroke="#000000" points="496.41,-214.2 505.87,-209.43 495.5,-207.26 496.41,-214.2"/>
</g>
<!-- dsin -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node28" class="node">
<title>dsin</title>
<polygon fill="#777777" stroke="#777777" points="560,-160 506,-160 506,-136 560,-136 560,-160"/>
<text text-anchor="middle" x="533" y="-145.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dsin</text>
</g>
<!-- proc~ltm2ll&#45;&gt;dsin -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge27" class="edge">
<title>proc~ltm2ll&#45;&gt;dsin</title>
<path fill="none" stroke="#000000" d="M436.02,-215.21C446.92,-211.78 459.48,-207.05 470,-201 485.96,-191.82 501.7,-178.3 513.32,-167.21"/>
<polygon fill="#000000" stroke="#000000" points="515.98,-169.5 520.67,-160 511.08,-164.51 515.98,-169.5"/>
</g>
<!-- dtan -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_node29" class="node">
<title>dtan</title>
<polygon fill="#777777" stroke="#777777" points="560,-87 506,-87 506,-63 560,-63 560,-87"/>
<text text-anchor="middle" x="533" y="-72.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dtan</text>
</g>
<!-- proc~ltm2ll&#45;&gt;dtan -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge28" class="edge">
<title>proc~ltm2ll&#45;&gt;dtan</title>
<path fill="none" stroke="#000000" d="M436.23,-217.51C447.68,-214.44 460.6,-209.37 470,-201 497.32,-176.68 489.82,-159.8 506,-127 510.97,-116.92 516.53,-105.78 521.24,-96.4"/>
<polygon fill="#000000" stroke="#000000" points="524.4,-97.89 525.76,-87.38 518.15,-94.75 524.4,-97.89"/>
</g>
<!-- proc~utm2ll&#45;&gt;dcos -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge29" class="edge">
<title>proc~utm2ll&#45;&gt;dcos</title>
<path fill="none" stroke="#000000" d="M436.1,-15.47C447.95,-18.32 461.23,-23.52 470,-33 512.46,-78.9 479.61,-112.31 506,-169 508.63,-174.65 512.13,-180.36 515.71,-185.55"/>
<polygon fill="#000000" stroke="#000000" points="512.93,-187.68 521.67,-193.67 518.58,-183.54 512.93,-187.68"/>
</g>
<!-- proc~utm2ll&#45;&gt;dsin -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge30" class="edge">
<title>proc~utm2ll&#45;&gt;dsin</title>
<path fill="none" stroke="#000000" d="M436.07,-16.68C447.49,-19.77 460.43,-24.83 470,-33 473.97,-36.39 504.25,-94.29 520.98,-126.61"/>
<polygon fill="#000000" stroke="#000000" points="517.99,-128.46 525.69,-135.73 524.21,-125.24 517.99,-128.46"/>
</g>
<!-- proc~utm2ll&#45;&gt;dtan -->
<g id="proc~~uemep_read_meteo_nc~~CallsGraph_edge31" class="edge">
<title>proc~utm2ll&#45;&gt;dtan</title>
<path fill="none" stroke="#000000" d="M436,-19.47C446.78,-22.99 459.25,-27.59 470,-33 483.2,-39.64 496.89,-48.66 508.05,-56.64"/>
<polygon fill="#000000" stroke="#000000" points="506.25,-59.66 516.39,-62.75 510.39,-54.01 506.25,-59.66"/>
</g>
</g>
</svg>
</div>          <div>
            <a type="button" class="graph-help" data-bs-toggle="modal" href="#CallsGraph-help-text">Help</a>
          </div>
          <div class="modal fade" id="CallsGraph-help-text" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
<p>Nodes of different colours represent the following: </p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="641pt" height="28pt"
 viewBox="0.00 0.00 641.00 27.51" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.86 0.86) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 741.5,-28 741.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="146,-24 88,-24 88,0 146,0 146,-24"/>
<text text-anchor="middle" x="117" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="225.5,-24 164.5,-24 164.5,0 225.5,0 225.5,-24"/>
<text text-anchor="middle" x="195" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Type Bound Procedure -->
<g id="node4" class="node">
<title>Type Bound Procedure</title>
<polygon fill="#a7506f" stroke="#a7506f" points="374,-24 244,-24 244,0 374,0 374,-24"/>
<text text-anchor="middle" x="309" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Type Bound Procedure</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node5" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="537.5,-24 392.5,-24 392.5,0 537.5,0 537.5,-24"/>
<text text-anchor="middle" x="465" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node6" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="614,-24 556,-24 556,0 614,0 614,-24"/>
<text text-anchor="middle" x="585" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node7" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="737.5,-24 632.5,-24 632.5,0 737.5,0 737.5,-24"/>
<text text-anchor="middle" x="685" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

<p>Solid arrows point from a procedure to one which it calls. Dashed 
arrows point from an interface to procedures which implement that interface.
This could include the module procedures in a generic interface or the
implementation in a submodule of an interface in a parent module.
</p>
 </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header">
  <h3 class="card-title">Called by</h3>
      </div>
      <div class="card-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proc~~uemep_read_meteo_nc~~CalledByGraph Pages: 1 -->
<svg id="procuemep_read_meteo_ncCalledByGraph" width="483pt" height="52pt"
 viewBox="0.00 0.00 483.00 52.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~uemep_read_meteo_nc~~CalledByGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 48)">
<title>proc~~uemep_read_meteo_nc~~CalledByGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-48 479,-48 479,4 -4,4"/>
<!-- proc~uemep_read_meteo_nc -->
<g id="proc~~uemep_read_meteo_nc~~CalledByGraph_node1" class="node">
<title>proc~uemep_read_meteo_nc</title>
<polygon fill="none" stroke="black" points="475,-44 340,-44 340,-20 475,-20 475,-44"/>
<text text-anchor="middle" x="407.5" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50">uEMEP_read_meteo_nc</text>
</g>
<!-- proc~uemep_calculate_emissions_for_emep -->
<g id="proc~~uemep_read_meteo_nc~~CalledByGraph_node2" class="node">
<title>proc~uemep_calculate_emissions_for_emep</title>
<g id="a_proc~~uemep_read_meteo_nc~~CalledByGraph_node2"><a xlink:href="../proc/uemep_calculate_emissions_for_emep.html" xlink:title="uEMEP_calculate_emissions_for_EMEP">
<polygon fill="#d9534f" stroke="#d9534f" points="304,-24 90,-24 90,0 304,0 304,-24"/>
<text text-anchor="middle" x="197" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">uEMEP_calculate_emissions_for_EMEP</text>
</a>
</g>
</g>
<!-- proc~uemep_calculate_emissions_for_emep&#45;&gt;proc~uemep_read_meteo_nc -->
<g id="proc~~uemep_read_meteo_nc~~CalledByGraph_edge1" class="edge">
<title>proc~uemep_calculate_emissions_for_emep&#45;&gt;proc~uemep_read_meteo_nc</title>
<path fill="none" stroke="#000000" d="M304.08,-22.18C312.74,-23.01 321.37,-23.83 329.76,-24.64"/>
<polygon fill="#000000" stroke="#000000" points="329.55,-28.13 339.84,-25.61 330.22,-21.17 329.55,-28.13"/>
</g>
<!-- program~uemep -->
<g id="proc~~uemep_read_meteo_nc~~CalledByGraph_node3" class="node">
<title>program~uemep</title>
<g id="a_proc~~uemep_read_meteo_nc~~CalledByGraph_node3"><a xlink:href="../program/uemep.html" xlink:title="uEMEP">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="54,-44 0,-44 0,-20 54,-20 54,-44"/>
<text text-anchor="middle" x="27" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">uEMEP</text>
</a>
</g>
</g>
<!-- program~uemep&#45;&gt;proc~uemep_read_meteo_nc -->
<g id="proc~~uemep_read_meteo_nc~~CalledByGraph_edge2" class="edge">
<title>program~uemep&#45;&gt;proc~uemep_read_meteo_nc</title>
<path fill="none" stroke="#000000" d="M54.24,-32.52C65.28,-32.71 78.27,-32.91 90,-33 185.11,-33.77 208.89,-33.46 304,-33 312.31,-32.96 321.01,-32.9 329.66,-32.83"/>
<polygon fill="#000000" stroke="#000000" points="329.82,-36.33 339.79,-32.75 329.76,-29.33 329.82,-36.33"/>
</g>
<!-- program~uemep&#45;&gt;proc~uemep_calculate_emissions_for_emep -->
<g id="proc~~uemep_read_meteo_nc~~CalledByGraph_edge3" class="edge">
<title>program~uemep&#45;&gt;proc~uemep_calculate_emissions_for_emep</title>
<path fill="none" stroke="#000000" d="M54.25,-28.88C63.1,-27.82 73.61,-26.57 84.84,-25.23"/>
<polygon fill="#000000" stroke="#000000" points="85.36,-28.7 94.88,-24.04 84.54,-21.74 85.36,-28.7"/>
</g>
</g>
</svg>
</div>          <div>
            <a type="button" class="graph-help" data-bs-toggle="modal" href="#CalledByGraph-help-text">Help</a>
          </div>
          <div class="modal fade" id="CalledByGraph-help-text" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
<p>Nodes of different colours represent the following: </p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="641pt" height="28pt"
 viewBox="0.00 0.00 641.00 27.51" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.86 0.86) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 741.5,-28 741.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="146,-24 88,-24 88,0 146,0 146,-24"/>
<text text-anchor="middle" x="117" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="225.5,-24 164.5,-24 164.5,0 225.5,0 225.5,-24"/>
<text text-anchor="middle" x="195" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Type Bound Procedure -->
<g id="node4" class="node">
<title>Type Bound Procedure</title>
<polygon fill="#a7506f" stroke="#a7506f" points="374,-24 244,-24 244,0 374,0 374,-24"/>
<text text-anchor="middle" x="309" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Type Bound Procedure</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node5" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="537.5,-24 392.5,-24 392.5,0 537.5,0 537.5,-24"/>
<text text-anchor="middle" x="465" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node6" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="614,-24 556,-24 556,0 614,0 614,-24"/>
<text text-anchor="middle" x="585" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node7" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="737.5,-24 632.5,-24 632.5,0 737.5,0 737.5,-24"/>
<text text-anchor="middle" x="685" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

<p>Solid arrows point from a procedure to one which it calls. Dashed 
arrows point from an interface to procedures which implement that interface.
This could include the module procedures in a generic interface or the
implementation in a submodule of an interface in a parent module.
</p>
 </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br>


    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">    </span><span class="k">subroutine </span><span class="n">uEMEP_read_meteo_nc</span>

<span class="w">        </span><span class="k">implicit none</span>

<span class="k">        </span><span class="kt">integer </span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span>
<span class="w">        </span><span class="kt">integer </span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span>
<span class="w">        </span><span class="kt">logical </span><span class="n">exists</span>
<span class="w">        </span><span class="kt">integer </span><span class="n">status_nc</span><span class="w">     </span><span class="c">!Error message</span>
<span class="w">        </span><span class="kt">integer </span><span class="n">id_nc</span>
<span class="w">        </span><span class="kt">integer </span><span class="n">dim_id_nc</span><span class="p">(</span><span class="n">num_dims_meteo_nc</span><span class="p">)</span>
<span class="w">        </span><span class="kt">character</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span><span class="w"> </span><span class="n">dimname_temp</span><span class="p">,</span><span class="n">var_name_nc_temp</span><span class="p">,</span><span class="n">unit_name_nc_temp</span>
<span class="w">        </span><span class="kt">integer </span><span class="n">var_id_nc</span>
<span class="w">        </span><span class="kt">integer </span><span class="n">i_file</span><span class="p">,</span><span class="n">i_dim</span>
<span class="w">        </span><span class="kt">integer </span><span class="n">temp_num_dims</span>
<span class="w">        </span><span class="kt">integer </span><span class="n">temp_start_time_meteo_nc_index</span><span class="p">,</span><span class="n">temp_end_time_meteo_nc_index</span>
<span class="w">        </span><span class="kt">integer </span><span class="n">valid_dim_length_meteo_nc</span><span class="p">(</span><span class="n">num_dims_meteo_nc</span><span class="p">)</span><span class="w"> </span><span class="c">!dimensions of file 3</span>

<span class="w">        </span><span class="kt">real </span><span class="n">temp_lat</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">temp_lon</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="w">        </span><span class="kt">real </span><span class="n">temp_y</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">temp_x</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="w">        </span><span class="kt">real </span><span class="n">temp_x_min</span><span class="p">,</span><span class="n">temp_x_max</span><span class="p">,</span><span class="n">temp_y_min</span><span class="p">,</span><span class="n">temp_y_max</span>
<span class="w">        </span><span class="kt">integer </span><span class="n">i_temp_min</span><span class="p">,</span><span class="n">i_temp_max</span><span class="p">,</span><span class="n">j_temp_min</span><span class="p">,</span><span class="n">j_temp_max</span>
<span class="w">        </span><span class="kt">double precision </span><span class="n">temp_var1d_nc_dp</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="w">        </span><span class="kt">real </span><span class="n">temp_delta</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="w">        </span><span class="kt">real </span><span class="n">scale_grid_interpolation_size</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="w">        </span><span class="kt">real </span><span class="n">EMEP_temp_delta</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="w">        </span><span class="kt">real </span><span class="n">temp_lat_mean</span>

<span class="w">        </span><span class="kt">integer </span><span class="n">n_file</span><span class="p">,</span><span class="n">n_file_start</span>
<span class="w">        </span><span class="kt">double precision </span><span class="n">date_num_temp</span>
<span class="w">        </span><span class="kt">integer </span><span class="n">date_array</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="w">        </span><span class="kt">double precision </span><span class="n">scale_factor_nc</span>

<span class="w">        </span><span class="kt">logical </span><span class="n">found_file</span>
<span class="w">        </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">search_hour_step</span><span class="o">=</span><span class="mi">6</span>
<span class="w">        </span><span class="kt">integer </span><span class="n">new_start_date_input</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="w">        </span><span class="kt">character</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span><span class="w"> </span><span class="n">format_temp</span>

<span class="w">        </span><span class="kt">real </span><span class="n">EMEP_grid_interpolation_size_temp</span>

<span class="w">        </span><span class="c">!Temporary reading rvariables</span>
<span class="w">        </span><span class="kt">double precision</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">var1d_nc_dp</span><span class="p">(:)</span>
<span class="w">        </span><span class="kt">double precision</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">var2d_nc_dp</span><span class="p">(:,:)</span>

<span class="w">        </span><span class="c">!Temporary files for roatating wind field</span>
<span class="w">        </span><span class="kt">real</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">temp_meteo_var3d_nc</span><span class="p">(:,:,:,:)</span>

<span class="w">        </span><span class="c">!Daily mean temperature variables</span>
<span class="w">        </span><span class="kt">integer </span><span class="n">DMT_start_time_nc_index</span><span class="p">,</span><span class="n">DMT_end_time_nc_index</span><span class="p">,</span><span class="n">DMT_dim_length_nc</span>


<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;================================================================&#39;</span>
<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Reading additional meteo data (uEMEP_read_meteo_nc)&#39;</span>
<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;================================================================&#39;</span>


<span class="w">        </span><span class="c">!This if statement is already specified in uEMEP_define_subgrid and is not necessary here</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hourly_calculations</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">temp_start_time_meteo_nc_index</span><span class="o">=</span><span class="n">start_time_meteo_nc_index</span>
<span class="w">            </span><span class="n">temp_end_time_meteo_nc_index</span><span class="o">=</span><span class="n">end_time_meteo_nc_index</span>
<span class="w">        </span><span class="k">else</span>
<span class="k">            </span><span class="n">temp_start_time_meteo_nc_index</span><span class="o">=</span><span class="mi">1</span>
<span class="w">            </span><span class="n">temp_end_time_meteo_nc_index</span><span class="o">=</span><span class="mi">1</span>
<span class="w">        </span><span class="k">endif</span>

<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">use_single_time_loop_flag</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">temp_start_time_meteo_nc_index</span><span class="o">=</span><span class="n">start_time_meteo_nc_index</span><span class="o">+</span><span class="n">t_loop</span><span class="o">-</span><span class="mi">1</span>
<span class="w">            </span><span class="n">temp_end_time_meteo_nc_index</span><span class="o">=</span><span class="n">temp_start_time_meteo_nc_index</span>
<span class="w">        </span><span class="k">endif</span>

<span class="w">        </span><span class="c">!Presettng the surface level to 1. Valid when there is no inverting of layers</span>
<span class="w">        </span><span class="n">surface_level_nc</span><span class="o">=</span><span class="mi">1</span>
<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,I)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Surface level base set to: &#39;</span><span class="p">,</span><span class="n">surface_level_nc</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">val_dim_meteo_nc</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="w"> </span><span class="p">(</span><span class="n">val_dim_meteo_nc</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">var1d_nc_dp</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="w"> </span><span class="p">(</span><span class="n">var1d_nc_dp</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">var2d_nc_dp</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="w"> </span><span class="p">(</span><span class="n">var2d_nc_dp</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">meteo_var1d_nc</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_var1d_nc</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">meteo_var2d_nc</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_var2d_nc</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">meteo_var4d_nc</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_var4d_nc</span><span class="p">)</span>

<span class="w">        </span><span class="c">!Loop through the meteorological files containing the data</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">use_alternative_meteorology_flag</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">n_file_start</span><span class="o">=</span><span class="mi">3</span>
<span class="w">            </span><span class="n">n_file</span><span class="o">=</span><span class="mi">3</span>
<span class="w">        </span><span class="k">endif</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">use_alternative_z0_flag</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">n_file_start</span><span class="o">=</span><span class="mi">4</span>
<span class="w">            </span><span class="n">n_file</span><span class="o">=</span><span class="mi">4</span>
<span class="w">        </span><span class="k">endif</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">use_alternative_meteorology_flag</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">use_alternative_z0_flag</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">n_file_start</span><span class="o">=</span><span class="mi">3</span>
<span class="w">            </span><span class="n">n_file</span><span class="o">=</span><span class="mi">4</span>
<span class="w">        </span><span class="k">endif</span>

<span class="k">        do </span><span class="n">i_file</span><span class="o">=</span><span class="n">n_file_start</span><span class="p">,</span><span class="n">n_file</span>

<span class="w">            </span><span class="c">!Set the filename</span>
<span class="w">            </span><span class="n">pathfilename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">)</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">pathname_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">filename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span>

<span class="w">            </span><span class="c">!Test existence of the filename 4. If does not exist then stop</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i_file</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                inquire</span><span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">pathfilename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">)),</span><span class="n">exist</span><span class="o">=</span><span class="n">exists</span><span class="p">)</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">exists</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; ERROR: Netcdf file does not exist: &#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">pathfilename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span>
<span class="w">                    </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;  STOPPING&#39;</span>
<span class="w">                    </span><span class="k">stop</span>
<span class="k">                endif</span>
<span class="k">            endif</span>

<span class="w">            </span><span class="c">!Test existence of the filename. If does not exist then try 6 hours before</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i_file</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>

<span class="k">                inquire</span><span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">pathfilename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">)),</span><span class="n">exist</span><span class="o">=</span><span class="n">exists</span><span class="p">)</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">exists</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; WARNING: Meteo netcdf file does not exist: &#39;</span><span class="p">,</span><span class="w">  </span><span class="nb">trim</span><span class="p">(</span><span class="n">pathfilename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span>
<span class="w">                    </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Will try 6 hours before 4 times&#39;</span>

<span class="w">                    </span><span class="c">!Start search back 6 hours</span>
<span class="w">                    </span><span class="n">found_file</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">                    </span><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hourly_calculations</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                            </span><span class="n">temp_start_time_meteo_nc_index</span><span class="o">=</span><span class="n">start_time_meteo_nc_index</span><span class="o">+</span><span class="n">search_hour_step</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                            </span><span class="n">temp_end_time_meteo_nc_index</span><span class="o">=</span><span class="n">end_time_meteo_nc_index</span><span class="o">+</span><span class="n">search_hour_step</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                        </span><span class="k">endif</span>
<span class="k">                        if</span><span class="w"> </span><span class="p">(</span><span class="n">use_single_time_loop_flag</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                            </span><span class="n">temp_start_time_meteo_nc_index</span><span class="o">=</span><span class="n">start_time_meteo_nc_index</span><span class="o">+</span><span class="n">t_loop</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">search_hour_step</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                            </span><span class="n">temp_end_time_meteo_nc_index</span><span class="o">=</span><span class="n">temp_start_time_meteo_nc_index</span><span class="o">+</span><span class="n">search_hour_step</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                        </span><span class="k">endif</span>
<span class="w">                        </span><span class="c">!Create new date_str</span>
<span class="w">                        </span><span class="n">format_temp</span><span class="o">=</span><span class="s1">&#39;yyyymmddHH&#39;</span>
<span class="w">                        </span><span class="k">call </span><span class="n">datestr_to_date</span><span class="p">(</span><span class="n">config_date_str</span><span class="p">,</span><span class="n">format_temp</span><span class="p">,</span><span class="n">new_start_date_input</span><span class="p">)</span>
<span class="w">                        </span><span class="n">date_num_temp</span><span class="o">=</span><span class="n">date_to_number</span><span class="p">(</span><span class="n">new_start_date_input</span><span class="p">,</span><span class="n">ref_year_meteo</span><span class="p">)</span>
<span class="w">                        </span><span class="k">call </span><span class="n">number_to_date</span><span class="p">(</span><span class="n">date_num_temp</span><span class="o">-</span><span class="nb">dble</span><span class="p">(</span><span class="n">search_hour_step</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="mi">2</span><span class="mf">4.</span><span class="p">),</span><span class="n">new_start_date_input</span><span class="p">,</span><span class="n">ref_year_meteo</span><span class="p">)</span>
<span class="w">                        </span><span class="c">!Replace replacement_date_str with &lt;yyyyhhmm&gt; so the new_start_date_input can be inserted</span>
<span class="w">                        </span><span class="n">format_temp</span><span class="o">=</span><span class="s1">&#39;&lt;yyyymmdd&gt;&#39;</span>
<span class="w">                        </span><span class="n">filename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">)</span><span class="o">=</span><span class="n">replace_string_char</span><span class="p">(</span><span class="n">format_temp</span><span class="p">,</span><span class="n">replacement_date_str</span><span class="p">,</span><span class="n">original_filename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span>
<span class="w">                        </span><span class="n">pathname_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">)</span><span class="o">=</span><span class="n">replace_string_char</span><span class="p">(</span><span class="n">format_temp</span><span class="p">,</span><span class="n">replacement_date_str</span><span class="p">,</span><span class="n">original_pathname_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span>
<span class="w">                        </span><span class="c">!write(*,*) trim(filename_EMEP(i_file)),&#39;  &#39;,trim(replacement_date_str)</span>
<span class="w">                        </span><span class="c">!Replace replacement_hour_str with &lt;HH&gt; so the forecast hour can be inserted</span>
<span class="w">                        </span><span class="n">format_temp</span><span class="o">=</span><span class="s1">&#39;&lt;HH&gt;&#39;</span>
<span class="w">                        </span><span class="n">filename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">)</span><span class="o">=</span><span class="n">replace_string_char</span><span class="p">(</span><span class="n">format_temp</span><span class="p">,</span><span class="n">replacement_hour_str</span><span class="p">,</span><span class="n">filename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span>
<span class="w">                        </span><span class="n">pathname_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">)</span><span class="o">=</span><span class="n">replace_string_char</span><span class="p">(</span><span class="n">format_temp</span><span class="p">,</span><span class="n">replacement_hour_str</span><span class="p">,</span><span class="n">pathname_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span>
<span class="w">                        </span><span class="c">!write(*,*) trim(filename_EMEP(i_file)),&#39;  &#39;,trim(forecast_hour_str)</span>
<span class="w">                        </span><span class="c">!Replace datestr twice for both forecast_hour and config_date</span>
<span class="w">                        </span><span class="k">call </span><span class="n">date_to_datestr_bracket</span><span class="p">(</span><span class="n">new_start_date_input</span><span class="p">,</span><span class="n">filename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">),</span><span class="n">filename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span>
<span class="w">                        </span><span class="k">call </span><span class="n">date_to_datestr_bracket</span><span class="p">(</span><span class="n">new_start_date_input</span><span class="p">,</span><span class="n">pathname_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">),</span><span class="n">pathname_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span>
<span class="w">                        </span><span class="k">call </span><span class="n">date_to_datestr_bracket</span><span class="p">(</span><span class="n">new_start_date_input</span><span class="p">,</span><span class="n">filename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">),</span><span class="n">filename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span>
<span class="w">                        </span><span class="k">call </span><span class="n">date_to_datestr_bracket</span><span class="p">(</span><span class="n">new_start_date_input</span><span class="p">,</span><span class="n">pathname_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">),</span><span class="n">pathname_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span>
<span class="w">                        </span><span class="n">pathfilename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">)</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">pathname_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">filename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span>
<span class="w">                        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Trying: &#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">pathfilename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span>
<span class="w">                        </span><span class="k">inquire</span><span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">pathfilename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">)),</span><span class="n">exist</span><span class="o">=</span><span class="n">exists</span><span class="p">)</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">exists</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                            </span><span class="n">found_file</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">                            </span><span class="k">exit</span>
<span class="k">                        else</span>
<span class="k">                            </span><span class="n">found_file</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">                        </span><span class="k">endif</span>
<span class="k">                    enddo</span>

<span class="k">                    if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">found_file</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                        write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; ERROR: Meteo netcdf file still does not exist: &#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">pathfilename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span>
<span class="w">                        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; STOPPING&#39;</span>
<span class="w">                        </span><span class="k">stop</span>
<span class="k">                    else</span>
<span class="k">                        write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Found earlier meteo netcdf file: &#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">pathfilename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span>
<span class="w">                        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,2i6)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; New start and end index: &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">temp_start_time_meteo_nc_index</span><span class="p">,</span><span class="n">temp_end_time_meteo_nc_index</span>
<span class="w">                    </span><span class="k">endif</span>

<span class="k">                endif</span>

<span class="k">            endif</span>

<span class="w">            </span><span class="c">!Open the netcdf file for reading</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(2A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Opening netcdf file: &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">pathfilename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">))</span>
<span class="w">            </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_OPEN</span><span class="w"> </span><span class="p">(</span><span class="n">pathfilename_EMEP</span><span class="p">(</span><span class="n">i_file</span><span class="p">),</span><span class="w"> </span><span class="n">nf90_nowrite</span><span class="p">,</span><span class="w"> </span><span class="n">id_nc</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status_nc</span><span class="w"> </span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="w"> </span><span class="n">NF90_NOERR</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,I)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;ERROR opening netcdf file. Stopping: &#39;</span><span class="p">,</span><span class="n">status_nc</span>
<span class="w">                </span><span class="k">stop</span>
<span class="k">            endif</span>

<span class="k">            </span><span class="n">meteo_nc_projection_type</span><span class="o">=</span><span class="n">LL_projection_index</span>

<span class="w">            </span><span class="c">!Find the projection. If no projection then in lat lon coordinates</span>
<span class="w">            </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_VARID</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="s1">&#39;projection_lambert&#39;</span><span class="p">,</span><span class="n">var_id_nc</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status_nc</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">NF90_NOERR</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="c">!If there is a projection then read in the attributes. All these are doubles</span>
<span class="w">                </span><span class="c">!status_nc = nf90_inquire_variable(id_nc, var_id_nc, natts = numAtts_projection)</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nf90_get_att</span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;standard_parallel&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">meteo_nc_projection_attributes</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">))</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nf90_get_att</span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;longitude_of_central_meridian&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">meteo_nc_projection_attributes</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nf90_get_att</span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;latitude_of_projection_origin&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">meteo_nc_projection_attributes</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nf90_get_att</span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;earth_radius&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">meteo_nc_projection_attributes</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="w">                </span><span class="n">meteo_nc_projection_type</span><span class="o">=</span><span class="n">LCC_projection_index</span>

<span class="w">                </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,5f12.2)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Reading lambert_conformal_conic projection. &#39;</span><span class="p">,</span><span class="n">meteo_nc_projection_attributes</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_nc_projection_attributes</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="n">meteo_nc_projection_attributes</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="nb">or</span><span class="p">.</span><span class="n">meteo_nc_projection_attributes</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="n">meteo_nc_projection_attributes</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">use_alternative_LCC_projection_flag</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">                    </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,l)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Using alternative lambert_conformal_conic projection: &#39;</span><span class="p">,</span><span class="n">use_alternative_LCC_projection_flag</span>
<span class="w">                </span><span class="k">else</span>
<span class="k">                    </span><span class="n">use_alternative_LCC_projection_flag</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">                </span><span class="k">endif</span>
<span class="w">                </span><span class="c">!Always set to true. i.e. not use anymore</span>
<span class="w">                </span><span class="n">use_alternative_LCC_projection_flag</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">            </span><span class="k">endif</span>

<span class="w">            </span><span class="c">!Find the projection. If no projection then in lat lon coordinates</span>
<span class="w">            </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_VARID</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="s1">&#39;Polar_Stereographic&#39;</span><span class="p">,</span><span class="n">var_id_nc</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status_nc</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">NF90_NOERR</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>

<span class="k">                </span><span class="n">EMEP_projection_attributes</span><span class="o">=</span><span class="mf">0.</span>
<span class="w">                </span><span class="n">EMEP_projection_attributes</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">=</span><span class="mf">6.370e6</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nf90_get_att</span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;straight_vertical_longitude_from_pole&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">meteo_nc_projection_attributes</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nf90_get_att</span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;latitude_of_projection_origin&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">meteo_nc_projection_attributes</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nf90_get_att</span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;false_easting&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">meteo_nc_projection_attributes</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nf90_get_att</span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;false_northing&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">meteo_nc_projection_attributes</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nf90_get_att</span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;earth_radius&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">meteo_nc_projection_attributes</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nf90_get_att</span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;scale_factor_at_projection_origin&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">meteo_nc_projection_attributes</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>

<span class="w">                </span><span class="n">meteo_nc_projection_type</span><span class="o">=</span><span class="n">PS_projection_index</span>

<span class="w">                </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,5f12.2)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Reading Polar_Stereographic projection. &#39;</span><span class="p">,</span><span class="n">meteo_nc_projection_attributes</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span>

<span class="w">            </span><span class="k">endif</span>

<span class="w">            </span><span class="c">!Find the (x,y,z,time) dimensions of the file</span>
<span class="w">            </span><span class="k">do </span><span class="n">i_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">num_dims_meteo_nc</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_DIMID</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="n">dim_name_meteo_nc</span><span class="p">(</span><span class="n">i_dim</span><span class="p">),</span><span class="n">dim_id_nc</span><span class="p">(</span><span class="n">i_dim</span><span class="p">))</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQUIRE_DIMENSION</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="n">dim_id_nc</span><span class="p">(</span><span class="n">i_dim</span><span class="p">),</span><span class="n">dimname_temp</span><span class="p">,</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i_dim</span><span class="p">))</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status_nc</span><span class="w"> </span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="w"> </span><span class="n">NF90_NOERR</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,A,A,I)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;No dimension information available for &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">dim_name_meteo_nc</span><span class="p">(</span><span class="n">i_dim</span><span class="p">)),</span><span class="s1">&#39; Setting to 1 with status: &#39;</span><span class="p">,</span><span class="n">status_nc</span>
<span class="w">                    </span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i_dim</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span>
<span class="w">                </span><span class="k">endif</span>
<span class="k">            enddo</span>

<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">i_file</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">valid_dim_length_meteo_nc</span><span class="o">=</span><span class="n">dim_length_meteo_nc</span>
<span class="w">            </span><span class="k">endif</span>

<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">i_file</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">subgrid_dim</span><span class="p">(</span><span class="n">t_dim_index</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,2I)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;ERROR: Specified time dimensions are greater than meteo netcdf dimensions. Stopping &#39;</span><span class="p">,</span><span class="n">subgrid_dim</span><span class="p">(</span><span class="n">t_dim_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">)</span>
<span class="w">                    </span><span class="k">stop</span>
<span class="k">                endif</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">temp_end_time_meteo_nc_index</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,2I)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;ERROR: Required meteo time dimension larger than available meteo time dimension. Stopping &#39;</span><span class="p">,</span><span class="n">temp_end_time_meteo_nc_index</span><span class="p">,</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">)</span>
<span class="w">                    </span><span class="k">stop</span>
<span class="k">                endif</span>
<span class="k">            endif</span>


<span class="k">            write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,6I)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Size of meteo dimensions (x,y,z,t): &#39;</span><span class="p">,</span><span class="n">dim_length_meteo_nc</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i_file</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">temp_start_time_meteo_nc_index</span>
<span class="w">                </span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">)</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">subgrid_dim</span><span class="p">(</span><span class="n">t_dim_index</span><span class="p">))</span>
<span class="w">            </span><span class="k">elseif</span><span class="w"> </span><span class="p">(</span><span class="n">i_file</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span>
<span class="w">                </span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span>
<span class="w">            </span><span class="k">endif</span>

<span class="k">            write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,6I)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; New size of meteo dimensions (x,y,z,t): &#39;</span><span class="p">,</span><span class="n">dim_length_meteo_nc</span>


<span class="w">            </span><span class="c">!Calculate the necessary extent of the meteo_nc grid region and only read these grids</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reduce_EMEP_region_flag</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="c">!Determine the LL cordinates of the target grid</span>
<span class="w">                </span><span class="c">!EMEP_grid_interpolation_size_temp=max(EMEP_grid_interpolation_size*local_fraction_grid_size_scaling,EMEP_additional_grid_interpolation_size_original*local_fraction_grid_size_scaling)</span>
<span class="w">                </span><span class="n">EMEP_grid_interpolation_size_temp</span><span class="o">=</span><span class="n">EMEP_grid_interpolation_size</span><span class="o">*</span><span class="n">local_fraction_grid_size_scaling</span>

<span class="w">                </span><span class="c">!Retrieve the four corners of the target grid in lat and lon</span>
<span class="w">                </span><span class="k">call </span><span class="n">PROJ2LL</span><span class="p">(</span><span class="n">init_subgrid_min</span><span class="p">(</span><span class="n">x_dim_index</span><span class="p">),</span><span class="n">init_subgrid_min</span><span class="p">(</span><span class="n">y_dim_index</span><span class="p">),</span><span class="n">temp_lon</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">temp_lat</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">projection_attributes</span><span class="p">,</span><span class="n">projection_type</span><span class="p">)</span>
<span class="w">                </span><span class="k">call </span><span class="n">PROJ2LL</span><span class="p">(</span><span class="n">init_subgrid_max</span><span class="p">(</span><span class="n">x_dim_index</span><span class="p">),</span><span class="n">init_subgrid_max</span><span class="p">(</span><span class="n">y_dim_index</span><span class="p">),</span><span class="n">temp_lon</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">temp_lat</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">projection_attributes</span><span class="p">,</span><span class="n">projection_type</span><span class="p">)</span>
<span class="w">                </span><span class="k">call </span><span class="n">PROJ2LL</span><span class="p">(</span><span class="n">init_subgrid_min</span><span class="p">(</span><span class="n">x_dim_index</span><span class="p">),</span><span class="n">init_subgrid_max</span><span class="p">(</span><span class="n">y_dim_index</span><span class="p">),</span><span class="n">temp_lon</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="n">temp_lat</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="n">projection_attributes</span><span class="p">,</span><span class="n">projection_type</span><span class="p">)</span>
<span class="w">                </span><span class="k">call </span><span class="n">PROJ2LL</span><span class="p">(</span><span class="n">init_subgrid_max</span><span class="p">(</span><span class="n">x_dim_index</span><span class="p">),</span><span class="n">init_subgrid_min</span><span class="p">(</span><span class="n">y_dim_index</span><span class="p">),</span><span class="n">temp_lon</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">temp_lat</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">projection_attributes</span><span class="p">,</span><span class="n">projection_type</span><span class="p">)</span>
<span class="w">                </span><span class="c">!call UTM2LL(utm_zone,init_subgrid_min(y_dim_index),init_subgrid_min(x_dim_index),temp_lat(1),temp_lon(1))</span>
<span class="w">                </span><span class="c">!call UTM2LL(utm_zone,init_subgrid_max(y_dim_index),init_subgrid_max(x_dim_index),temp_lat(2),temp_lon(2))</span>
<span class="w">                </span><span class="c">!call UTM2LL(utm_zone,init_subgrid_max(y_dim_index),init_subgrid_min(x_dim_index),temp_lat(3),temp_lon(3))</span>
<span class="w">                </span><span class="c">!call UTM2LL(utm_zone,init_subgrid_min(y_dim_index),init_subgrid_max(x_dim_index),temp_lat(4),temp_lon(4))</span>

<span class="w">                </span><span class="c">!Find the average for use later</span>
<span class="w">                </span><span class="n">temp_lat_mean</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">temp_lat</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>

<span class="w">                </span><span class="n">temp_x_min</span><span class="o">=</span><span class="mf">1.e32</span><span class="p">;</span><span class="n">temp_y_min</span><span class="o">=</span><span class="mf">1.e32</span>
<span class="w">                </span><span class="n">temp_x_max</span><span class="o">=-</span><span class="mf">1.e32</span><span class="p">;</span><span class="n">temp_y_max</span><span class="o">=-</span><span class="mf">1.e32</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_nc_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">LCC_projection_index</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="c">!Convert lat lon corners to lambert</span>
<span class="w">                    </span><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span>
<span class="w">                        </span><span class="k">call </span><span class="n">lb2lambert2_uEMEP</span><span class="p">(</span><span class="n">temp_x</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">temp_y</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">temp_lon</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">temp_lat</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">meteo_nc_projection_attributes</span><span class="p">)</span>
<span class="w">                    </span><span class="k">enddo</span>
<span class="k">                elseif</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_nc_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">PS_projection_index</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="c">!Convert lat lon corners to lambert</span>
<span class="w">                    </span><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span>
<span class="w">                        </span><span class="k">call </span><span class="n">LL2PS_spherical</span><span class="p">(</span><span class="n">temp_x</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">temp_y</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">temp_lon</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">temp_lat</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">meteo_nc_projection_attributes</span><span class="p">)</span>
<span class="w">                    </span><span class="k">enddo</span>
<span class="k">                elseif</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_nc_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">LL_projection_index</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="c">!Set lat lon corners if EMEP is in lat lon</span>
<span class="w">                    </span><span class="n">temp_x</span><span class="o">=</span><span class="n">temp_lon</span><span class="p">;</span><span class="n">temp_y</span><span class="o">=</span><span class="n">temp_lat</span>
<span class="w">                </span><span class="k">else</span>
<span class="w">                    </span><span class="c">!Otherwise assume the same coordinate system</span>
<span class="w">                    </span><span class="n">temp_x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">init_subgrid_min</span><span class="p">(</span><span class="n">x_dim_index</span><span class="p">);</span><span class="n">temp_y</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">init_subgrid_min</span><span class="p">(</span><span class="n">y_dim_index</span><span class="p">)</span>
<span class="w">                    </span><span class="n">temp_x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="n">init_subgrid_max</span><span class="p">(</span><span class="n">x_dim_index</span><span class="p">);</span><span class="n">temp_y</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="n">init_subgrid_min</span><span class="p">(</span><span class="n">y_dim_index</span><span class="p">)</span>
<span class="w">                    </span><span class="n">temp_x</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="n">init_subgrid_min</span><span class="p">(</span><span class="n">x_dim_index</span><span class="p">);</span><span class="n">temp_y</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="n">init_subgrid_max</span><span class="p">(</span><span class="n">y_dim_index</span><span class="p">)</span>
<span class="w">                    </span><span class="n">temp_x</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">=</span><span class="n">init_subgrid_max</span><span class="p">(</span><span class="n">x_dim_index</span><span class="p">);</span><span class="n">temp_y</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">=</span><span class="n">init_subgrid_max</span><span class="p">(</span><span class="n">y_dim_index</span><span class="p">)</span>
<span class="w">                </span><span class="k">endif</span>

<span class="k">                do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">temp_x</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="n">temp_x_min</span><span class="p">)</span><span class="w"> </span><span class="n">temp_x_min</span><span class="o">=</span><span class="n">temp_x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">temp_y</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="n">temp_y_min</span><span class="p">)</span><span class="w"> </span><span class="n">temp_y_min</span><span class="o">=</span><span class="n">temp_y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">temp_x</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="n">temp_x_max</span><span class="p">)</span><span class="w"> </span><span class="n">temp_x_max</span><span class="o">=</span><span class="n">temp_x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">temp_y</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="n">temp_y_max</span><span class="p">)</span><span class="w"> </span><span class="n">temp_y_max</span><span class="o">=</span><span class="n">temp_y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                </span><span class="k">enddo</span>

<span class="w">                </span><span class="c">!Read in the first 2 x and y position values from the nc file to get min values and delta values</span>
<span class="w">                </span><span class="c">!write(*,*) temp_x_min,temp_x_max,temp_y_min,temp_y_max</span>

<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_VARID</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">dim_name_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">)),</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">)</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="n">temp_var1d_nc_dp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">),</span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="p">))</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_VARID</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">dim_name_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">)),</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">)</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="n">temp_var1d_nc_dp</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">),</span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="p">))</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nf90_get_att</span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;units&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">unit_name_nc_temp</span><span class="p">)</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">unit_name_nc_temp</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;km&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Units of x y data are in kilometres. Converting to metres&#39;</span>
<span class="w">                    </span><span class="n">temp_var1d_nc_dp</span><span class="o">=</span><span class="n">temp_var1d_nc_dp</span><span class="o">*</span><span class="mi">100</span><span class="mf">0.</span>
<span class="w">                </span><span class="k">endif</span>

<span class="w">                </span><span class="c">!HERE FIX. The EMEP_grid_interpolation_size is too small when using EMEP is a different grid to the meteo grid. Need to rescale this somehow</span>
<span class="w">                </span><span class="c">!By using meteo_dgrid_nc(lon_nc_index), not defined yet, and dgrid_nc(lon_nc_index)</span>
<span class="w">                </span><span class="c">!For example  dx_temp=111000.*dgrid_nc(lon_nc_index)*cos(lat_temp*pi/180.) and dy_temp=111000.*dgrid_nc(lat_nc_index)</span>

<span class="w">                </span><span class="c">!write(*,*) temp_var1d_nc_dp</span>
<span class="w">                </span><span class="n">temp_delta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">temp_var1d_nc_dp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">temp_var1d_nc_dp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                </span><span class="n">temp_delta</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="n">temp_var1d_nc_dp</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">temp_var1d_nc_dp</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                </span><span class="c">!write(*,*) temp_delta</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">meteo_nc_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">LCC_projection_index</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">EMEP_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">LCC_projection_index</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="p">.</span><span class="nb">or</span><span class="p">.(</span><span class="n">meteo_nc_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">LL_projection_index</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">EMEP_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">LL_projection_index</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="p">.</span><span class="nb">or</span><span class="p">.(</span><span class="n">meteo_nc_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">PS_projection_index</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">EMEP_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">PS_projection_index</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="c">!If both EMEP and meteo are in the same coordinates then set the EMEP size to be the same as the meteo siz</span>
<span class="w">                    </span><span class="n">EMEP_temp_delta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">dgrid_nc</span><span class="p">(</span><span class="n">lon_nc_index</span><span class="p">)</span>
<span class="w">                    </span><span class="n">EMEP_temp_delta</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="n">dgrid_nc</span><span class="p">(</span><span class="n">lat_nc_index</span><span class="p">)</span>
<span class="w">                </span><span class="k">elseif</span><span class="w"> </span><span class="p">((</span><span class="n">meteo_nc_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">LCC_projection_index</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">EMEP_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">LL_projection_index</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="p">.</span><span class="nb">or</span><span class="p">.(</span><span class="n">meteo_nc_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">PS_projection_index</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">EMEP_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">LL_projection_index</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="c">!EMEP is in latlon, convert to local coordinates</span>
<span class="w">                    </span><span class="n">EMEP_temp_delta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">dgrid_nc</span><span class="p">(</span><span class="n">lon_nc_index</span><span class="p">)</span><span class="o">*</span><span class="mi">11100</span><span class="mf">0.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">temp_lat_mean</span><span class="o">*</span><span class="mf">3.14159</span><span class="o">/</span><span class="mi">18</span><span class="mf">0.</span><span class="p">)</span>
<span class="w">                    </span><span class="n">EMEP_temp_delta</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="n">dgrid_nc</span><span class="p">(</span><span class="n">lat_nc_index</span><span class="p">)</span><span class="o">*</span><span class="mi">11100</span><span class="mf">0.</span>
<span class="w">                </span><span class="k">elseif</span><span class="w"> </span><span class="p">((</span><span class="n">meteo_nc_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">LL_projection_index</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">EMEP_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">LCC_projection_index</span><span class="p">)&amp;</span>
<span class="w">                    </span><span class="p">.</span><span class="nb">or</span><span class="p">.(</span><span class="n">meteo_nc_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">LL_projection_index</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">EMEP_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">PS_projection_index</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="c">!This conversion not available</span>
<span class="w">                    </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,3I)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Use of lat lon projection in meteo data, together with Lambert or PS in EMEP not available. Stopping&#39;</span>
<span class="w">                    </span><span class="k">stop</span>
<span class="k">                else</span>
<span class="k">                    write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,3I)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Use of current projections in meteo and EMEP data not available. Stopping&#39;</span>
<span class="w">                    </span><span class="k">stop</span>
<span class="k">                endif</span>

<span class="k">                </span><span class="n">scale_grid_interpolation_size</span><span class="o">=</span><span class="n">EMEP_temp_delta</span><span class="o">/</span><span class="n">temp_delta</span>
<span class="w">                </span><span class="c">!write(*,*) dgrid_nc(lon_nc_index),dgrid_nc(lat_nc_index)</span>
<span class="w">                </span><span class="c">!write(*,*) EMEP_temp_delta</span>
<span class="w">                </span><span class="c">!write(*,*) scale_grid_interpolation_size</span>
<span class="w">                </span><span class="c">!stop</span>

<span class="w">                </span><span class="c">!Find grid position of the max and min coordinates and add2 grids*EMEP_grid_interpolation_size</span>
<span class="w">                </span><span class="n">i_temp_min</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="nb">floor</span><span class="p">((</span><span class="n">temp_x_min</span><span class="o">-</span><span class="n">temp_var1d_nc_dp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">temp_delta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
<span class="w">                </span><span class="n">i_temp_max</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="nb">floor</span><span class="p">((</span><span class="n">temp_x_max</span><span class="o">-</span><span class="n">temp_var1d_nc_dp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">temp_delta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
<span class="w">                </span><span class="n">j_temp_min</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="nb">floor</span><span class="p">((</span><span class="n">temp_y_min</span><span class="o">-</span><span class="n">temp_var1d_nc_dp</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">temp_delta</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
<span class="w">                </span><span class="n">j_temp_max</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="nb">floor</span><span class="p">((</span><span class="n">temp_y_max</span><span class="o">-</span><span class="n">temp_var1d_nc_dp</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">temp_delta</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
<span class="w">                </span><span class="c">!write(unit_logfile,&#39;(A,2I)&#39;) &#39; Reading EMEP i grids: &#39;,i_temp_min,i_temp_max</span>
<span class="w">                </span><span class="c">!write(unit_logfile,&#39;(A,2I)&#39;) &#39; Reading EMEP j grids: &#39;,j_temp_min,j_temp_max</span>
<span class="w">                </span><span class="n">i_temp_min</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i_temp_min</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="nb">ceiling</span><span class="p">(</span><span class="n">scale_grid_interpolation_size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">EMEP_grid_interpolation_size_temp</span><span class="p">))</span>
<span class="w">                </span><span class="n">i_temp_max</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">i_temp_max</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="nb">ceiling</span><span class="p">(</span><span class="n">scale_grid_interpolation_size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">EMEP_grid_interpolation_size_temp</span><span class="p">))</span>
<span class="w">                </span><span class="n">j_temp_min</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j_temp_min</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="nb">ceiling</span><span class="p">(</span><span class="n">scale_grid_interpolation_size</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">EMEP_grid_interpolation_size_temp</span><span class="p">))</span>
<span class="w">                </span><span class="n">j_temp_max</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="n">j_temp_max</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="nb">ceiling</span><span class="p">(</span><span class="n">scale_grid_interpolation_size</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">EMEP_grid_interpolation_size_temp</span><span class="p">))</span>
<span class="w">                </span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">i_temp_max</span><span class="o">-</span><span class="n">i_temp_min</span><span class="o">+</span><span class="mi">1</span>
<span class="w">                </span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">j_temp_max</span><span class="o">-</span><span class="n">j_temp_min</span><span class="o">+</span><span class="mi">1</span>
<span class="w">                </span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">i_temp_min</span>
<span class="w">                </span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">j_temp_min</span>
<span class="w">                </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,3I)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Reading meteo x grids: &#39;</span><span class="p">,</span><span class="n">i_temp_min</span><span class="p">,</span><span class="n">i_temp_max</span><span class="p">,</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">)</span>
<span class="w">                </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,3I)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Reading meteo y grids: &#39;</span><span class="p">,</span><span class="n">j_temp_min</span><span class="p">,</span><span class="n">j_temp_max</span><span class="p">,</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">)</span>

<span class="w">                </span><span class="c">!Set the new valid meteo dimensions</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i_file</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">valid_dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">)</span>
<span class="w">                    </span><span class="n">valid_dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">)</span>
<span class="w">                </span><span class="k">endif</span>

<span class="k">            endif</span>

<span class="w">            </span><span class="c">!Allocate the nc arrays for reading</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">val_dim_meteo_nc</span><span class="p">))</span><span class="w"> </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">val_dim_meteo_nc</span><span class="p">(</span><span class="nb">maxval</span><span class="p">(</span><span class="n">dim_length_meteo_nc</span><span class="p">),</span><span class="n">num_dims_meteo_nc</span><span class="p">))</span><span class="w"> </span><span class="c">!x, y, z and time dimension values</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">unit_dim_meteo_nc</span><span class="p">))</span><span class="w"> </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">unit_dim_meteo_nc</span><span class="p">(</span><span class="n">num_dims_meteo_nc</span><span class="p">))</span><span class="w"> </span><span class="c">!x, y, z and time dimension values</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">var1d_nc_dp</span><span class="p">))</span><span class="w"> </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">var1d_nc_dp</span><span class="p">(</span><span class="nb">maxval</span><span class="p">(</span><span class="n">dim_length_meteo_nc</span><span class="p">)))</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">var2d_nc_dp</span><span class="p">))</span><span class="w"> </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">var2d_nc_dp</span><span class="p">(</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">)))</span><span class="w"> </span><span class="c">!Lat and lon</span>

<span class="w">            </span><span class="c">!Allocate array for the alternative meteo files</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i_file</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">meteo_var1d_nc</span><span class="p">))</span><span class="w"> </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_var1d_nc</span><span class="p">(</span><span class="nb">maxval</span><span class="p">(</span><span class="n">dim_length_meteo_nc</span><span class="p">),</span><span class="n">num_dims_meteo_nc</span><span class="p">))</span><span class="w"> </span><span class="c">!x, y, z and time maximum dimensions</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">meteo_var2d_nc</span><span class="p">))</span><span class="w"> </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_var2d_nc</span><span class="p">(</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span><span class="w"> </span><span class="c">!Lat and lon</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">))</span><span class="w"> </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="mi">0</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">num_var_meteo_nc</span><span class="p">))</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">meteo_var4d_nc</span><span class="p">))</span><span class="w"> </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_var4d_nc</span><span class="p">(</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">),</span><span class="mi">0</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">num_var_meteo_nc</span><span class="p">))</span>

<span class="w">            </span><span class="k">endif</span>

<span class="w">            </span><span class="c">!Read in the dimensions and check values of the dimensions.</span>
<span class="w">            </span><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">num_dims_meteo_nc</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_VARID</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">dim_name_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">)</span>
<span class="w">                </span><span class="c">!write(*,*) id_nc, trim(dim_name_nc(i)), var_id_nc(i),dim_length_nc(i)</span>
<span class="w">                </span><span class="n">var1d_nc_dp</span><span class="o">=</span><span class="mf">0.</span>
<span class="w">                </span><span class="c">!write(*,*) &#39;HERE&#39;,i,dim_start_nc(i),dim_length_nc(i)</span>
<span class="w">                </span><span class="n">unit_dim_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status_nc</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="n">NF90_NOERR</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nf90_get_att</span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;units&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">unit_dim_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="w">                    </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="n">var1d_nc_dp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="p">));</span><span class="n">meteo_var1d_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">var1d_nc_dp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
<span class="w">                    </span><span class="c">!Use the first file to give valid time stamps</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i_file</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">3.</span><span class="nb">and</span><span class="p">.</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">time_dim_nc_index</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                        </span><span class="n">val_dim_meteo_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">var1d_nc_dp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
<span class="w">                        </span><span class="n">valid_dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="k">endif</span>
<span class="w">                    </span><span class="c">!Use first file to get the valid height of the wind measurements (height3)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i_file</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">3.</span><span class="nb">and</span><span class="p">.</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">z_dim_nc_index</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                        </span><span class="n">val_dim_meteo_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">var1d_nc_dp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
<span class="w">                        </span><span class="n">valid_dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="k">endif</span>

<span class="w">                    </span><span class="c">!Convert from meters to km for AROME data if necessary</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">x_dim_nc_index</span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">y_dim_nc_index</span><span class="p">).</span><span class="nb">and</span><span class="p">.</span><span class="nb">trim</span><span class="p">(</span><span class="n">unit_dim_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;km&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                        write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Units of x y data are in kilometres. Converting to metres&#39;</span>
<span class="w">                        </span><span class="n">val_dim_meteo_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">val_dim_meteo_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="mf">0.</span>
<span class="w">                        </span><span class="n">meteo_var1d_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var1d_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="mf">0.</span>
<span class="w">                    </span><span class="k">endif</span>

<span class="k">                    write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(3A,2es12.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">dim_name_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="s1">&#39; (min, max): &#39;</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">meteo_var1d_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="p">)),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">meteo_var1d_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="p">))</span>

<span class="w">                </span><span class="k">else</span>
<span class="w">                    </span><span class="c">!meteo_var1d_nc(1:dim_length_meteo_nc(i),i)=0.</span>
<span class="w">                    </span><span class="c">!val_dim_meteo_nc(1:dim_length_meteo_nc(i),i)=0.</span>
<span class="w">                </span><span class="k">endif</span>
<span class="k">            enddo</span>


<span class="w">            </span><span class="c">!i_conc=compound_index</span>

<span class="w">            </span><span class="c">!Loop through the meteo_variables</span>
<span class="w">            </span><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">num_var_meteo_nc</span>

<span class="w">                </span><span class="c">!Identify the variable name and ID in the nc file</span>
<span class="w">                </span><span class="n">var_name_nc_temp</span><span class="o">=</span><span class="n">var_name_meteo_nc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_VARID</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_nc_temp</span><span class="p">),</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">)</span>
<span class="w">                </span><span class="c">!write(*,*) &#39;Status1: &#39;,status_nc,var_id_nc,trim(var_name_nc_temp),i_source</span>

<span class="w">                </span><span class="c">!If a variable name is found in the file then go further</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status_nc</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">NF90_NOERR</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">scale_factor_nc</span><span class="o">=</span><span class="mf">1.</span>
<span class="w">                    </span><span class="c">!Find the dimensions of the variable (temp_num_dims)</span>
<span class="w">                    </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQUIRE_VARIABLE</span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">ndims</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp_num_dims</span><span class="p">)</span>
<span class="w">                    </span><span class="c">!write(*,*) temp_num_dims,status_nc</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">temp_num_dims</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">2.</span><span class="nb">and</span><span class="p">.</span><span class="n">i_file</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                        </span><span class="c">!Read latitude and longitude data into a 2d grid if available. Only lat lon is 2d?</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">lat_nc_index</span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">lon_nc_index</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                            </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var2d_nc_dp</span><span class="p">);</span><span class="n">meteo_var2d_nc</span><span class="p">(:,:,</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">var2d_nc_dp</span><span class="p">)</span>
<span class="w">                            </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,i3,A,2A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Reading: &#39;</span><span class="p">,</span><span class="n">temp_num_dims</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_nc_temp</span><span class="p">),</span><span class="s1">&#39; (min, max): &#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">meteo_var2d_nc</span><span class="p">(:,:,</span><span class="n">i</span><span class="p">)),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">meteo_var2d_nc</span><span class="p">(:,:,</span><span class="n">i</span><span class="p">))</span>
<span class="w">                        </span><span class="k">endif</span>
<span class="k">                    elseif</span><span class="w"> </span><span class="p">(</span><span class="n">temp_num_dims</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">3.</span><span class="nb">and</span><span class="p">.</span><span class="n">i_file</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                        </span><span class="c">!Special case for z0 file as they are scaled integers and a single time file</span>
<span class="w">                        </span><span class="c">!write(*,&#39;(6i)&#39;) dim_start_nc(x_dim_nc_index),dim_start_nc(y_dim_nc_index),dim_start_nc(time_dim_nc_index),dim_length_nc(x_dim_nc_index),dim_length_nc(y_dim_nc_index),dim_length_nc(time_dim_nc_index)</span>
<span class="w">                        </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nf90_get_att</span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;scale_factor&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">scale_factor_nc</span><span class="p">)</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status_nc</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">NF90_NOERR</span><span class="p">)</span><span class="w"> </span><span class="n">scale_factor_nc</span><span class="o">=</span><span class="mf">1.</span>
<span class="w">                        </span><span class="c">!write(*,*) &#39;scale_factor=&#39;,scale_factor_nc</span>
<span class="w">                        </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">),</span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">)</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">)</span><span class="o">/</span><span class="p">))</span>
<span class="w">                        </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">scale_factor_nc</span><span class="p">)</span>
<span class="w">                        </span><span class="c">!write(*,*) status_nc</span>
<span class="w">                        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,I,3A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Reading: &#39;</span><span class="p">,</span><span class="n">temp_num_dims</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_nc_temp</span><span class="p">),</span><span class="s1">&#39; (min, max): &#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">i</span><span class="p">)),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">i</span><span class="p">))</span>
<span class="w">                    </span><span class="k">elseif</span><span class="w"> </span><span class="p">(</span><span class="n">temp_num_dims</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">4.</span><span class="nb">and</span><span class="p">.</span><span class="n">i_file</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                        </span><span class="c">!write(*,*) dim_start_nc(z_dim_nc_index),dim_start_nc(z_dim_nc_index)+dim_length_nc(z_dim_nc_index)-1</span>
<span class="w">                        </span><span class="c">!write(*,*) dim_start_nc(x_dim_nc_index),dim_start_nc(y_dim_nc_index),dim_start_nc(z_dim_nc_index),dim_start_nc(time_dim_nc_index)</span>
<span class="w">                        </span><span class="c">!write(*,*) dim_length_nc(x_dim_nc_index),dim_length_nc(y_dim_nc_index),dim_length_nc(z_dim_nc_index),dim_length_nc(time_dim_nc_index)</span>
<span class="w">                        </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">):</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">)</span><span class="o">+</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,</span><span class="n">i</span><span class="p">),</span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">),</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="p">))</span>
<span class="w">                        </span><span class="c">!status_nc = NF90_GET_VAR (id_nc, var_id_nc, meteo_var4d_nc(:,:,dim_start_meteo_nc(z_dim_nc_index):dim_start_meteo_nc(z_dim_nc_index)+dim_length_meteo_nc(z_dim_nc_index)-1,dim_start_meteo_nc(time_dim_nc_index)-1:dim_start_meteo_nc(time_dim_nc_index)+dim_length_meteo_nc(time_dim_nc_index)-1,i),start=(/dim_start_meteo_nc(x_dim_nc_index),dim_start_meteo_nc(y_dim_nc_index),dim_start_meteo_nc(z_dim_nc_index),dim_start_meteo_nc(time_dim_nc_index)-1/),count=(/dim_length_meteo_nc(x_dim_nc_index),dim_length_meteo_nc(y_dim_nc_index),dim_length_meteo_nc(z_dim_nc_index),dim_length_meteo_nc(time_dim_nc_index)+1/))</span>
<span class="w">                        </span><span class="c">!status_nc = NF90_GET_VAR (id_nc, var_id_nc, meteo_var4d_nc(:,:,1,dim_start_meteo_nc(time_dim_nc_index):dim_length_meteo_nc(time_dim_nc_index),i),start=(/dim_start_meteo_nc(x_dim_nc_index),dim_start_meteo_nc(y_dim_nc_index),1,dim_start_meteo_nc(time_dim_nc_index)/),count=(/dim_length_meteo_nc(x_dim_nc_index),dim_length_meteo_nc(y_dim_nc_index),1,dim_length_meteo_nc(time_dim_nc_index)/))</span>
<span class="w">                        </span><span class="c">!status_nc = NF90_GET_VAR (id_nc, var_id_nc, temp_var4d_nc(:,:,:,:),start=(/dim_start_nc(x_dim_nc_index),dim_start_nc(y_dim_nc_index),dim_start_nc(z_dim_nc_index),temp_start_time_nc_index/),count=(/dim_length_nc(x_dim_nc_index),dim_length_nc(y_dim_nc_index),dim_length_nc(z_dim_nc_index),dim_length_nc(time_dim_nc_index)/))</span>
<span class="w">                        </span><span class="c">!var4d_nc(:,val_dim_nc:,:,:,i,i_source)=real(temp_var4d_nc(:,:,:,:))</span>
<span class="w">                        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,I,3A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Reading: &#39;</span><span class="p">,</span><span class="n">temp_num_dims</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_nc_temp</span><span class="p">),</span><span class="s1">&#39; (min, max): &#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">):</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">)</span><span class="o">+</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">i</span><span class="p">)),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">meteo_var4d_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">):</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">)</span><span class="o">+</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">i</span><span class="p">))</span>
<span class="w">                        </span><span class="c">!write(*,*) dim_start_meteo_nc(time_dim_nc_index)-1,dim_length_meteo_nc(time_dim_nc_index)+1,dim_start_meteo_nc(z_dim_nc_index),dim_start_meteo_nc(z_dim_nc_index)+dim_length_meteo_nc(z_dim_nc_index)-1</span>
<span class="w">                    </span><span class="k">elseif</span><span class="w"> </span><span class="p">(</span><span class="n">temp_num_dims</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">3.</span><span class="nb">and</span><span class="p">.</span><span class="n">i_file</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                        </span><span class="c">!NBV meteo data</span>
<span class="w">                        </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nf90_get_att</span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;scale_factor&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">scale_factor_nc</span><span class="p">)</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status_nc</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">NF90_NOERR</span><span class="p">)</span><span class="w"> </span><span class="n">scale_factor_nc</span><span class="o">=</span><span class="mf">1.</span>
<span class="w">                        </span><span class="c">!write(*,*) dim_start_nc(z_dim_nc_index),dim_start_nc(z_dim_nc_index)+dim_length_nc(z_dim_nc_index)-1</span>
<span class="w">                        </span><span class="c">!write(*,*) dim_start_nc(x_dim_nc_index),dim_start_nc(y_dim_nc_index),dim_start_nc(z_dim_nc_index),dim_start_nc(time_dim_nc_index)</span>
<span class="w">                        </span><span class="c">!write(*,*) dim_length_nc(x_dim_nc_index),dim_length_nc(y_dim_nc_index),dim_length_nc(z_dim_nc_index),dim_length_nc(time_dim_nc_index)</span>
<span class="w">                        </span><span class="c">!status_nc = NF90_GET_VAR (id_nc, var_id_nc, meteo_var4d_nc(:,:,1,:,i),start=(/dim_start_meteo_nc(x_dim_nc_index),dim_start_meteo_nc(y_dim_nc_index),dim_start_meteo_nc(time_dim_nc_index)-1/),count=(/dim_length_meteo_nc(x_dim_nc_index),dim_length_meteo_nc(y_dim_nc_index),dim_length_meteo_nc(time_dim_nc_index)+1/))</span>
<span class="w">                        </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">,</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">):</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">i</span><span class="p">),</span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">)</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">)</span><span class="o">/</span><span class="p">))</span>
<span class="w">                        </span><span class="c">!status_nc = NF90_GET_VAR (id_nc, var_id_nc, temp_var4d_nc(:,:,:,:),start=(/dim_start_nc(x_dim_nc_index),dim_start_nc(y_dim_nc_index),dim_start_nc(z_dim_nc_index),temp_start_time_nc_index/),count=(/dim_length_nc(x_dim_nc_index),dim_length_nc(y_dim_nc_index),dim_length_nc(z_dim_nc_index),dim_length_nc(time_dim_nc_index)/))</span>
<span class="w">                        </span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,:,:,</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,:,:,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">scale_factor_nc</span><span class="p">)</span>
<span class="w">                        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,I,3A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Reading: &#39;</span><span class="p">,</span><span class="n">temp_num_dims</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_nc_temp</span><span class="p">),</span><span class="s1">&#39; (min, max): &#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">i</span><span class="p">)),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">meteo_var4d_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">i</span><span class="p">))</span>
<span class="w">                        </span><span class="c">!write(*,*) dim_start_meteo_nc(time_dim_nc_index)-1,dim_length_meteo_nc(time_dim_nc_index)+1,dim_start_meteo_nc(z_dim_nc_index),dim_start_meteo_nc(z_dim_nc_index)+dim_length_meteo_nc(z_dim_nc_index)-1</span>
<span class="w">                    </span><span class="k">elseif</span><span class="w"> </span><span class="p">(</span><span class="n">temp_num_dims</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">5.</span><span class="nb">and</span><span class="p">.</span><span class="n">i_file</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                        </span><span class="c">!This is the case when there is an ensemble member in the format</span>
<span class="w">                        </span><span class="c">!write(*,*) dim_start_nc(z_dim_nc_index),dim_start_nc(z_dim_nc_index)+dim_length_nc(z_dim_nc_index)-1</span>
<span class="w">                        </span><span class="c">!write(*,*) dim_start_nc(x_dim_nc_index),dim_start_nc(y_dim_nc_index),dim_start_nc(z_dim_nc_index),dim_start_nc(time_dim_nc_index)</span>
<span class="w">                        </span><span class="c">!write(*,*) dim_length_nc(x_dim_nc_index),dim_length_nc(y_dim_nc_index),dim_length_nc(z_dim_nc_index),dim_length_nc(time_dim_nc_index)</span>
<span class="w">                        </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">):</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">)</span><span class="o">+</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,</span><span class="n">i</span><span class="p">),</span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">),</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="p">))</span>
<span class="w">                        </span><span class="c">!status_nc = NF90_GET_VAR (id_nc, var_id_nc, temp_var4d_nc(:,:,:,:),start=(/dim_start_nc(x_dim_nc_index),dim_start_nc(y_dim_nc_index),dim_start_nc(z_dim_nc_index),temp_start_time_nc_index/),count=(/dim_length_nc(x_dim_nc_index),dim_length_nc(y_dim_nc_index),dim_length_nc(z_dim_nc_index),dim_length_nc(time_dim_nc_index)/))</span>
<span class="w">                        </span><span class="c">!var4d_nc(:,val_dim_nc:,:,:,i,i_source)=real(temp_var4d_nc(:,:,:,:))</span>
<span class="w">                        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,I,3A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Reading: &#39;</span><span class="p">,</span><span class="n">temp_num_dims</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_nc_temp</span><span class="p">),</span><span class="s1">&#39; (min, max): &#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">):</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">)</span><span class="o">+</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">i</span><span class="p">)),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">meteo_var4d_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">):</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">)</span><span class="o">+</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">z_dim_nc_index</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">i</span><span class="p">))</span>
<span class="w">                        </span><span class="c">!write(*,*) dim_start_meteo_nc(time_dim_nc_index)-1,dim_length_meteo_nc(time_dim_nc_index)+1,dim_start_meteo_nc(z_dim_nc_index),dim_start_meteo_nc(z_dim_nc_index)+dim_length_meteo_nc(z_dim_nc_index)-1</span>
<span class="w">                    </span><span class="k">else</span>
<span class="k">                        write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(8A,8A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Cannot find a correct dimension for: &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_nc_temp</span><span class="p">)</span>
<span class="w">                    </span><span class="k">endif</span>

<span class="k">                else</span>
<span class="w">                    </span><span class="c">!write(unit_logfile,&#39;(8A,8A)&#39;) &#39; Cannot read: &#39;,trim(var_name_nc_temp)</span>
<span class="w">                </span><span class="k">endif</span>

<span class="k">            enddo</span>

<span class="w">            </span><span class="c">!Read in 2m temperature completely to get the daily average for home heating</span>
<span class="w">            </span><span class="c">!if (use_RWC_emission_data.and.save_emissions_for_EMEP(heating_index).and.i_file.eq.3) then</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">use_RWC_emission_data</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">i_file</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">DMT_start_time_nc_index</span><span class="o">=</span><span class="n">start_time_meteo_nc_index</span>
<span class="w">                </span><span class="n">DMT_end_time_nc_index</span><span class="o">=</span><span class="n">end_time_meteo_nc_index</span>
<span class="w">                </span><span class="c">!DMT_start_time_nc_index=save_emissions_start_index</span>
<span class="w">                </span><span class="c">!DMT_end_time_nc_index=save_emissions_end_index</span>

<span class="w">                </span><span class="n">DMT_dim_length_nc</span><span class="o">=</span><span class="n">DMT_end_time_nc_index</span><span class="o">-</span><span class="n">DMT_start_time_nc_index</span><span class="o">+</span><span class="mi">1</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">DMT_EMEP_grid_nc</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="w"> </span><span class="p">(</span><span class="n">DMT_EMEP_grid_nc</span><span class="p">)</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">DMT_EMEP_grid_nc</span><span class="p">))</span><span class="w"> </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">DMT_EMEP_grid_nc</span><span class="p">(</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="n">DMT_dim_length_nc</span><span class="p">))</span>

<span class="w">                </span><span class="c">!write(*,*) DMT_start_time_nc_index,DMT_end_time_nc_index,DMT_dim_length_nc</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">calculate_source</span><span class="p">(</span><span class="n">heating_index</span><span class="p">).</span><span class="nb">and</span><span class="p">.</span><span class="n">i_file</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">var_name_nc_temp</span><span class="o">=</span><span class="n">var_name_meteo_nc</span><span class="p">(</span><span class="n">t2m_nc_index</span><span class="p">)</span>
<span class="w">                    </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_VARID</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_nc_temp</span><span class="p">),</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">)</span>
<span class="w">                    </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQUIRE_VARIABLE</span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">ndims</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp_num_dims</span><span class="p">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">temp_num_dims</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                        </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">DMT_EMEP_grid_nc</span><span class="p">(:,:,:),</span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">DMT_start_time_nc_index</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">DMT_dim_length_nc</span><span class="o">/</span><span class="p">))</span>
<span class="w">                    </span><span class="k">elseif</span><span class="w"> </span><span class="p">(</span><span class="n">temp_num_dims</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                        </span><span class="c">!NBV meteo data</span>
<span class="w">                        </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">DMT_EMEP_grid_nc</span><span class="p">(:,:,:),</span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="n">DMT_start_time_nc_index</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="n">DMT_dim_length_nc</span><span class="o">/</span><span class="p">))</span>
<span class="w">                    </span><span class="k">elseif</span><span class="w"> </span><span class="p">(</span><span class="n">temp_num_dims</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                        </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">var_id_nc</span><span class="p">,</span><span class="w"> </span><span class="n">DMT_EMEP_grid_nc</span><span class="p">(:,:,:),</span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_start_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">DMT_start_time_nc_index</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">DMT_dim_length_nc</span><span class="o">/</span><span class="p">))</span>
<span class="w">                    </span><span class="k">else</span>
<span class="k">                        write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(8A,8A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Cannot find a correct dimension for: &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_nc_temp</span><span class="p">)</span>
<span class="w">                    </span><span class="k">endif</span>

<span class="k">                    write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,i,3A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Reading: &#39;</span><span class="p">,</span><span class="n">temp_num_dims</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_nc_temp</span><span class="p">),</span><span class="s1">&#39; (min, max): &#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">DMT_EMEP_grid_nc</span><span class="p">),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">DMT_EMEP_grid_nc</span><span class="p">)</span>
<span class="w">                    </span><span class="n">DMT_EMEP_grid_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">DMT_EMEP_grid_nc</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">DMT_dim_length_nc</span><span class="o">-</span><span class="mi">27</span><span class="mf">3.13</span>
<span class="w">                    </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(3A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Calculating mean: &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="s1">&#39;Daily mean temperature&#39;</span><span class="p">),</span><span class="s1">&#39; (min, max): &#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">DMT_EMEP_grid_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">)),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">DMT_EMEP_grid_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">))</span>

<span class="w">                </span><span class="k">endif</span>

<span class="k">            endif</span>

<span class="k">            </span><span class="n">status_nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_CLOSE</span><span class="w"> </span><span class="p">(</span><span class="n">id_nc</span><span class="p">)</span>

<span class="w">        </span><span class="k">enddo</span><span class="w"> </span><span class="c">!End file loop</span>

<span class="w">        </span><span class="c">!Set the correct time dimensions to the first file value</span>
<span class="w">        </span><span class="n">dim_length_meteo_nc</span><span class="o">=</span><span class="n">valid_dim_length_meteo_nc</span>

<span class="w">        </span><span class="c">!Set the grid spacing</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_nc_projection_type</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">LL_projection_index</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">meteo_dgrid_nc</span><span class="p">(</span><span class="n">lon_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var1d_nc</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">x_dim_nc_index</span><span class="p">)</span><span class="o">-</span><span class="n">meteo_var1d_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x_dim_nc_index</span><span class="p">)</span>
<span class="w">            </span><span class="n">meteo_dgrid_nc</span><span class="p">(</span><span class="n">lat_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var1d_nc</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">y_dim_nc_index</span><span class="p">)</span><span class="o">-</span><span class="n">meteo_var1d_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">y_dim_nc_index</span><span class="p">)</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Grid spacing meteo (lon,lat): &#39;</span><span class="p">,</span><span class="n">meteo_dgrid_nc</span><span class="p">(</span><span class="n">lon_nc_index</span><span class="p">),</span><span class="n">meteo_dgrid_nc</span><span class="p">(</span><span class="n">lat_nc_index</span><span class="p">)</span>
<span class="w">        </span><span class="k">else</span>
<span class="k">            </span><span class="n">meteo_dgrid_nc</span><span class="p">(</span><span class="n">lon_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var1d_nc</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">x_dim_nc_index</span><span class="p">)</span><span class="o">-</span><span class="n">meteo_var1d_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x_dim_nc_index</span><span class="p">)</span>
<span class="w">            </span><span class="n">meteo_dgrid_nc</span><span class="p">(</span><span class="n">lat_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var1d_nc</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">y_dim_nc_index</span><span class="p">)</span><span class="o">-</span><span class="n">meteo_var1d_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">y_dim_nc_index</span><span class="p">)</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Grid spacing meteo (x,y) in meters: &#39;</span><span class="p">,</span><span class="n">meteo_dgrid_nc</span><span class="p">(</span><span class="n">lon_nc_index</span><span class="p">),</span><span class="n">meteo_dgrid_nc</span><span class="p">(</span><span class="n">lat_nc_index</span><span class="p">)</span>
<span class="w">        </span><span class="k">endif</span>


<span class="w">        </span><span class="c">!Do manipulations when the additional meteorology is read in</span>
<span class="w">        </span><span class="c">!Put everything in 3d data since it is all surface values</span>
<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Calculating alternative meteorological data&#39;</span>
<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,4i)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Dimensions: &#39;</span><span class="p">,</span><span class="n">dim_length_meteo_nc</span>
<span class="w">        </span><span class="c">!logz0 is read in as z0 and must be converted to logz0</span>
<span class="w">        </span><span class="k">do </span><span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">)</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="n">t</span><span class="p">,</span><span class="n">logz0_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">,</span><span class="n">logz0_nc_index</span><span class="p">)</span>
<span class="w">            </span><span class="c">!write(*,*) t,sum(meteo_var3d_nc(:,:,t,logz0_nc_index))/dim_length_meteo_nc(x_dim_nc_index)/dim_length_meteo_nc(y_dim_nc_index)</span>
<span class="w">        </span><span class="k">enddo</span>
<span class="k">        where</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">logz0_nc_index</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="mf">0.001</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">logz0_nc_index</span><span class="p">)</span><span class="o">=</span><span class="mf">0.001</span>
<span class="w">        </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">logz0_nc_index</span><span class="p">)</span><span class="o">=</span><span class="nb">log</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">logz0_nc_index</span><span class="p">))</span>

<span class="w">        </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">t2m_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">surface_level_nc</span><span class="p">,:,</span><span class="n">t2m_nc_index</span><span class="p">)</span>
<span class="w">        </span><span class="c">!Assumes that the first step is 0 and data is hourly. So that the start time step for meteo must correspond to the second hour of any calculation</span>
<span class="w">        </span><span class="c">!t=1</span>
<span class="w">        </span><span class="c">!meteo_var3d_nc(:,:,t,Hflux_nc_index)=meteo_var4d_nc(:,:,surface_level_nc,t,Hflux_nc_index)/3600.</span>
<span class="w">        </span><span class="c">!meteo_var3d_nc(:,:,t,uw_nc_index)=meteo_var4d_nc(:,:,surface_level_nc,t,uw_nc_index)/3600.</span>
<span class="w">        </span><span class="c">!meteo_var3d_nc(:,:,t,vw_nc_index)=meteo_var4d_nc(:,:,surface_level_nc,t,vw_nc_index)/3600.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">alternative_meteorology_type</span><span class="p">,</span><span class="s1">&#39;nbv&#39;</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="c">!Flux is upward and not integrated. Stress is not integrated</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">Hflux_nc_index</span><span class="p">)</span><span class="o">=-</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">surface_level_nc</span><span class="p">,:,</span><span class="n">Hflux_nc_index</span><span class="p">)</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">uw_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">surface_level_nc</span><span class="p">,:,</span><span class="n">uw_nc_index</span><span class="p">)</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">vw_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">surface_level_nc</span><span class="p">,:,</span><span class="n">vw_nc_index</span><span class="p">)</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">precip_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">surface_level_nc</span><span class="p">,:,</span><span class="n">precip_nc_index</span><span class="p">)</span>
<span class="w">        </span><span class="k">else</span>
<span class="k">            do </span><span class="n">t</span><span class="o">=</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>
<span class="w">                </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="n">t</span><span class="p">,</span><span class="n">Hflux_nc_index</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">surface_level_nc</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">Hflux_nc_index</span><span class="p">)</span><span class="o">-</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">surface_level_nc</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">Hflux_nc_index</span><span class="p">))</span><span class="o">/</span><span class="mi">360</span><span class="mf">0.</span>
<span class="w">                </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="n">t</span><span class="p">,</span><span class="n">uw_nc_index</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">surface_level_nc</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">uw_nc_index</span><span class="p">)</span><span class="o">-</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">surface_level_nc</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">uw_nc_index</span><span class="p">))</span><span class="o">/</span><span class="mi">360</span><span class="mf">0.</span>
<span class="w">                </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="n">t</span><span class="p">,</span><span class="n">vw_nc_index</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">surface_level_nc</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">vw_nc_index</span><span class="p">)</span><span class="o">-</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">surface_level_nc</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">vw_nc_index</span><span class="p">))</span><span class="o">/</span><span class="mi">360</span><span class="mf">0.</span>
<span class="w">                </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="n">t</span><span class="p">,</span><span class="n">precip_nc_index</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">surface_level_nc</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">precip_nc_index</span><span class="p">)</span><span class="o">-</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">surface_level_nc</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">precip_nc_index</span><span class="p">))</span>
<span class="w">                </span><span class="c">!write(*,*) t,sum(meteo_var3d_nc(:,:,t,Hflux_nc_index))/dim_length_meteo_nc(x_dim_nc_index)/dim_length_meteo_nc(y_dim_nc_index) &amp;</span>
<span class="w">                </span><span class="c">!    ,sum(meteo_var4d_nc(:,:,surface_level_nc,t,hmix_nc_index))/dim_length_meteo_nc(x_dim_nc_index)/dim_length_meteo_nc(y_dim_nc_index)</span>
<span class="w">            </span><span class="k">enddo</span>
<span class="k">        endif</span>

<span class="w">        </span><span class="c">!Approximate density of air used (1.2 kg/m^3 +/- 10%)</span>
<span class="w">        </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ustar_nc_index</span><span class="p">)</span><span class="o">=</span><span class="nb">sqrt</span><span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">uw_nc_index</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">vw_nc_index</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">1.2</span><span class="p">)</span>
<span class="w">        </span><span class="k">where</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ustar_nc_index</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="n">ustar_min</span><span class="p">)</span><span class="w"> </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ustar_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">ustar_min</span>
<span class="w">        </span><span class="c">!do t=dim_length_meteo_nc(time_dim_nc_index),0,-1</span>
<span class="w">        </span><span class="c">!     write(*,*) t,sum(meteo_var3d_nc(:,:,t,ustar_nc_index))/dim_length_meteo_nc(x_dim_nc_index)/dim_length_meteo_nc(y_dim_nc_index) &amp;</span>
<span class="w">        </span><span class="c">!        ,sum(meteo_var3d_nc(:,:,t,uw_nc_index))/dim_length_meteo_nc(x_dim_nc_index)/dim_length_meteo_nc(y_dim_nc_index) &amp;</span>
<span class="w">        </span><span class="c">!        ,sum(meteo_var3d_nc(:,:,t,vw_nc_index))/dim_length_meteo_nc(x_dim_nc_index)/dim_length_meteo_nc(y_dim_nc_index)</span>
<span class="w">        </span><span class="c">!enddo</span>

<span class="w">        </span><span class="c">!Approximate temperature (273 +/- 10%)</span>
<span class="w">        </span><span class="c">!Have inserted the correct temperature now</span>
<span class="w">        </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">invL_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">Hflux_nc_index</span><span class="p">)</span><span class="o">*</span><span class="mf">0.4</span><span class="o">*</span><span class="mf">9.8</span><span class="o">/</span><span class="mf">1.2</span><span class="o">/</span><span class="mi">100</span><span class="mf">4.</span><span class="o">/</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">t2m_nc_index</span><span class="p">)</span><span class="o">/</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ustar_nc_index</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span>
<span class="w">        </span><span class="c">!Limit stable L to lowest_stable_L and to lowest_unstable_L (negative number) for unstable.</span>
<span class="w">        </span><span class="k">where</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">invL_nc_index</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="mf">1.0</span><span class="o">/</span><span class="n">lowest_unstable_L</span><span class="p">)</span><span class="w"> </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">invL_nc_index</span><span class="p">)</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">lowest_unstable_L</span>
<span class="w">        </span><span class="k">where</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">invL_nc_index</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mf">1.0</span><span class="o">/</span><span class="n">lowest_stable_L</span><span class="p">)</span><span class="w"> </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">invL_nc_index</span><span class="p">)</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">lowest_stable_L</span>

<span class="w">        </span><span class="c">!Put the 10 m wind vectors as the lowest grid level</span>
<span class="w">        </span><span class="c">!H_meteo=val_dim_meteo_nc(surface_level_nc,z_dim_nc_index)</span>
<span class="w">        </span><span class="n">H_meteo</span><span class="o">=</span><span class="mi">1</span><span class="mf">0.</span>
<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,f8.2)&#39;</span><span class="p">)</span><span class="s1">&#39; Alternative meteo: setting lowest meteo grid height = &#39;</span><span class="p">,</span><span class="n">H_meteo</span>
<span class="w">        </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ugrid_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">surface_level_nc</span><span class="p">,:,</span><span class="n">u10_nc_index</span><span class="p">)</span>
<span class="w">        </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">vgrid_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">surface_level_nc</span><span class="p">,:,</span><span class="n">v10_nc_index</span><span class="p">)</span>
<span class="w">        </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">FF10_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var4d_nc</span><span class="p">(:,:,</span><span class="n">surface_level_nc</span><span class="p">,:,</span><span class="n">FF10_nc_index</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">FF10_nc_index</span><span class="p">))).</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="c">!Calculate wind speed if it can&#39;t read it</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">FF10_nc_index</span><span class="p">)</span><span class="o">=</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ugrid_nc_index</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">vgrid_nc_index</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="w">        </span><span class="k">else</span>
<span class="k">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">FF10_nc_index</span><span class="p">)</span><span class="o">=</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">u10_nc_index</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">v10_nc_index</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="w">        </span><span class="k">endif</span>

<span class="w">        </span><span class="c">!Smooth the boundary layer height (running mean) and set minimum</span>
<span class="w">        </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">hmix_nc_index</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
<span class="w">        </span><span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
<span class="w">            </span><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
<span class="w">                </span><span class="k">do </span><span class="n">jj</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<span class="w">                    </span><span class="k">do </span><span class="n">ii</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<span class="w">                        </span><span class="n">meteo_var3d_nc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,:,</span><span class="n">hmix_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var3d_nc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,:,</span><span class="n">hmix_nc_index</span><span class="p">)</span><span class="o">+</span><span class="n">meteo_var4d_nc</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="n">jj</span><span class="p">,</span><span class="n">surface_level_nc</span><span class="p">,:,</span><span class="n">hmix_nc_index</span><span class="p">)</span><span class="o">/</span><span class="mf">9.</span>
<span class="w">                        </span><span class="c">!if (ii.ne.0.and.jj.ne.0) then</span>
<span class="w">                        </span><span class="c">!    var3d_nc(i,j,:,hmix_nc_index,allsource_index)=var3d_nc(i,j,:,hmix_nc_index,allsource_index)-var3d_nc(i+ii,j+jj,:,hmix_nc_index,traffic_index)/8.</span>
<span class="w">                        </span><span class="c">!endif</span>
<span class="w">                    </span><span class="k">enddo</span>
<span class="k">                enddo</span>

<span class="k">            enddo</span>
<span class="k">        enddo</span>
<span class="k">        where</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">hmix_nc_index</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="n">hmix_min</span><span class="p">)</span><span class="w"> </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">hmix_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">hmix_min</span>
<span class="w">        </span><span class="k">where</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">hmix_nc_index</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="n">hmix_max</span><span class="p">)</span><span class="w"> </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">hmix_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">hmix_max</span>
<span class="w">        </span><span class="k">where</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ustar_nc_index</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="n">ustar_min</span><span class="p">)</span><span class="w"> </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ustar_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">ustar_min</span>
<span class="w">        </span><span class="c">!do t=dim_length_nc(time_dim_nc_index),2,-1</span>
<span class="w">        </span><span class="c">!    write(*,*) t,sum(var3d_nc(:,:,t,hmix_nc_index,allsource_nc_index))/dim_length_nc(x_dim_nc_index)/dim_length_nc(y_dim_nc_index)</span>
<span class="w">        </span><span class="c">!enddo</span>

<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(3A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Alternative meteo: &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_meteo_nc</span><span class="p">(</span><span class="n">logz0_nc_index</span><span class="p">)),</span><span class="s1">&#39; (min, max): &#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">logz0_nc_index</span><span class="p">)),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">logz0_nc_index</span><span class="p">))</span>
<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(3A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Alternative meteo: &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_meteo_nc</span><span class="p">(</span><span class="n">ustar_nc_index</span><span class="p">)),</span><span class="s1">&#39; (min, max): &#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">ustar_nc_index</span><span class="p">)),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">ustar_nc_index</span><span class="p">))</span>
<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(3A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Alternative meteo: &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_meteo_nc</span><span class="p">(</span><span class="n">Hflux_nc_index</span><span class="p">)),</span><span class="s1">&#39; (min, max): &#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">Hflux_nc_index</span><span class="p">)),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">Hflux_nc_index</span><span class="p">))</span>
<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(3A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Alternative meteo: &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_meteo_nc</span><span class="p">(</span><span class="n">invL_nc_index</span><span class="p">)),</span><span class="s1">&#39; (min, max): &#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">invL_nc_index</span><span class="p">)),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">invL_nc_index</span><span class="p">))</span>
<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(3A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Alternative meteo: &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_meteo_nc</span><span class="p">(</span><span class="n">ugrid_nc_index</span><span class="p">)),</span><span class="s1">&#39; (min, max): &#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">ugrid_nc_index</span><span class="p">)),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">ugrid_nc_index</span><span class="p">))</span>
<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(3A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Alternative meteo: &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_meteo_nc</span><span class="p">(</span><span class="n">vgrid_nc_index</span><span class="p">)),</span><span class="s1">&#39; (min, max): &#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">vgrid_nc_index</span><span class="p">)),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">vgrid_nc_index</span><span class="p">))</span>
<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(3A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Alternative meteo: &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_meteo_nc</span><span class="p">(</span><span class="n">FF10_nc_index</span><span class="p">)),</span><span class="s1">&#39; (min, max): &#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">FF10_nc_index</span><span class="p">)),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">FF10_nc_index</span><span class="p">))</span>
<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(3A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Alternative meteo: &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_meteo_nc</span><span class="p">(</span><span class="n">hmix_nc_index</span><span class="p">)),</span><span class="s1">&#39; (min, max): &#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">hmix_nc_index</span><span class="p">)),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">hmix_nc_index</span><span class="p">))</span>
<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(3A,2f16.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Alternative meteo: &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">var_name_meteo_nc</span><span class="p">(</span><span class="n">t2m_nc_index</span><span class="p">)),</span><span class="s1">&#39; (min, max): &#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">t2m_nc_index</span><span class="p">)),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">t2m_nc_index</span><span class="p">))</span>


<span class="w">        </span><span class="c">!If no logz0 available. Set to log(0.1)</span>
<span class="w">        </span><span class="c">!For urban areas a value of 0.3 is used</span>
<span class="w">        </span><span class="c">!where (var3d_nc(:,:,:,logz0_nc_index,:).eq.0.0) var3d_nc(:,:,:,logz0_nc_index,:)=log(0.3)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">replace_z0</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">NODATA_value</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,f8.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Replacing z0 everywhere with: &#39;</span><span class="p">,</span><span class="n">replace_z0</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">logz0_nc_index</span><span class="p">)</span><span class="o">=</span><span class="nb">log</span><span class="p">(</span><span class="n">replace_z0</span><span class="p">)</span>
<span class="w">        </span><span class="k">endif</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">replace_invL</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">NODATA_value</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,f8.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Replacing inverse L everywhere with: &#39;</span><span class="p">,</span><span class="n">replace_invL</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">invL_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">replace_invL</span>
<span class="w">        </span><span class="k">endif</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">replace_hmix</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">NODATA_value</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,f8.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Replacing HMIX everywhere with: &#39;</span><span class="p">,</span><span class="n">replace_hmix</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">hmix_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">replace_hmix</span>
<span class="w">        </span><span class="k">endif</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">FF_scale</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">NODATA_value</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,f8.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Rescaling wind fields everywhere with factor: &#39;</span><span class="p">,</span><span class="n">FF_scale</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ustar_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ustar_nc_index</span><span class="p">)</span><span class="o">*</span><span class="n">FF_scale</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">FF10_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">FF10_nc_index</span><span class="p">)</span><span class="o">*</span><span class="n">FF_scale</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">inv_FF10_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">inv_FF10_nc_index</span><span class="p">)</span><span class="o">/</span><span class="n">FF_scale</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ugrid_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ugrid_nc_index</span><span class="p">)</span><span class="o">*</span><span class="n">FF_scale</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">vgrid_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">vgrid_nc_index</span><span class="p">)</span><span class="o">*</span><span class="n">FF_scale</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">inv_FFgrid_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">inv_FFgrid_nc_index</span><span class="p">)</span><span class="o">/</span><span class="n">FF_scale</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ugrid_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ugrid_nc_index</span><span class="p">)</span><span class="o">*</span><span class="n">FF_scale</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">vgrid_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">vgrid_nc_index</span><span class="p">)</span><span class="o">*</span><span class="n">FF_scale</span>
<span class="w">        </span><span class="k">endif</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">FF10_offset</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">NODATA_value</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,f8.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Offsetting 10 m wind fields everywhere with a value: &#39;</span><span class="p">,</span><span class="n">FF10_offset</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">FF10_nc_index</span><span class="p">)</span><span class="o">=</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">FF10_nc_index</span><span class="p">)</span><span class="o">+</span><span class="n">FF10_offset</span>
<span class="w">        </span><span class="k">endif</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">DD_offset</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">NODATA_value</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(A,f8.4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Rotating wind fields everywhere with a value: &#39;</span><span class="p">,</span><span class="n">DD_offset</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">temp_meteo_var3d_nc</span><span class="p">))</span><span class="w"> </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">temp_meteo_var3d_nc</span><span class="p">(</span><span class="n">valid_dim_length_meteo_nc</span><span class="p">(</span><span class="n">x_dim_nc_index</span><span class="p">),</span><span class="n">valid_dim_length_meteo_nc</span><span class="p">(</span><span class="n">y_dim_nc_index</span><span class="p">),</span><span class="n">valid_dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
<span class="w">            </span><span class="n">temp_meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ugrid_nc_index</span><span class="p">)</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">DD_offset</span><span class="o">/</span><span class="mi">18</span><span class="mf">0.</span><span class="o">*</span><span class="mf">3.14159</span><span class="p">)</span><span class="o">+</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">vgrid_nc_index</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">DD_offset</span><span class="o">/</span><span class="mi">18</span><span class="mf">0.</span><span class="o">*</span><span class="mf">3.14159</span><span class="p">)</span>
<span class="w">            </span><span class="n">temp_meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=-</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ugrid_nc_index</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">DD_offset</span><span class="o">/</span><span class="mi">18</span><span class="mf">0.</span><span class="o">*</span><span class="mf">3.14159</span><span class="p">)</span><span class="o">+</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">vgrid_nc_index</span><span class="p">)</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">DD_offset</span><span class="o">/</span><span class="mi">18</span><span class="mf">0.</span><span class="o">*</span><span class="mf">3.14159</span><span class="p">)</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ugrid_nc_index</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp_meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="mi">1</span><span class="p">)</span>
<span class="w">            </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">vgrid_nc_index</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp_meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="mi">2</span><span class="p">)</span>
<span class="w">        </span><span class="k">endif</span>

<span class="w">        </span><span class="c">!Set the magnitude of the gridded wind fields. Should probably be done after subgridding?</span>
<span class="w">        </span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">FFgrid_nc_index</span><span class="p">)</span><span class="o">=</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">ugrid_nc_index</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">meteo_var3d_nc</span><span class="p">(:,:,:,</span><span class="n">vgrid_nc_index</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="w">        </span><span class="c">!Check meteo time which comes in seconds since 1970. Converts to days.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">use_alternative_meteorology_flag</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">date_num_temp</span><span class="o">=</span><span class="n">val_dim_meteo_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">time_dim_nc_index</span><span class="p">)</span><span class="o">/</span><span class="mi">360</span><span class="mf">0.</span><span class="o">/</span><span class="mi">2</span><span class="mf">4.</span><span class="o">+</span><span class="mi">3</span><span class="mf">0.</span><span class="o">/</span><span class="mi">2</span><span class="mf">4.</span><span class="o">/</span><span class="mi">360</span><span class="mf">0.</span>
<span class="w">            </span><span class="k">call </span><span class="n">number_to_date</span><span class="p">(</span><span class="n">date_num_temp</span><span class="p">,</span><span class="n">date_array</span><span class="p">,</span><span class="n">ref_year_meteo</span><span class="p">)</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(a,i6)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Time dimension meteo: &#39;</span><span class="p">,</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">)</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(a,6i6)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Date start meteo = &#39;</span><span class="p">,</span><span class="n">date_array</span>
<span class="w">            </span><span class="c">!date_num_temp=dble(ceiling(val_dim_meteo_nc(dim_length_meteo_nc(time_dim_nc_index),time_dim_nc_index)/3600.))/24.</span>
<span class="w">            </span><span class="n">date_num_temp</span><span class="o">=</span><span class="n">val_dim_meteo_nc</span><span class="p">(</span><span class="n">dim_length_meteo_nc</span><span class="p">(</span><span class="n">time_dim_nc_index</span><span class="p">),</span><span class="n">time_dim_nc_index</span><span class="p">)</span><span class="o">/</span><span class="mi">360</span><span class="mf">0.</span><span class="o">/</span><span class="mi">2</span><span class="mf">4.</span><span class="o">+</span><span class="mi">3</span><span class="mf">0.</span><span class="o">/</span><span class="mi">2</span><span class="mf">4.</span><span class="o">/</span><span class="mi">360</span><span class="mf">0.</span>
<span class="w">            </span><span class="k">call </span><span class="n">number_to_date</span><span class="p">(</span><span class="n">date_num_temp</span><span class="p">,</span><span class="n">date_array</span><span class="p">,</span><span class="n">ref_year_meteo</span><span class="p">)</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="n">unit_logfile</span><span class="p">,</span><span class="s1">&#39;(a,6i6)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Date end meteo =   &#39;</span><span class="p">,</span><span class="n">date_array</span>
<span class="w">            </span><span class="c">!write(*,*) start_time_meteo_nc_index,valid_dim_length_meteo_nc(time_dim_nc_index)</span>
<span class="w">        </span><span class="k">endif</span>
<span class="w">        </span><span class="c">!do t=1,dim_length_meteo_nc(time_dim_nc_index)</span>
<span class="w">        </span><span class="c">!    date_num_temp=val_dim_meteo_nc(t,time_dim_nc_index)/3600./24.+0.1/24.</span>
<span class="w">        </span><span class="c">!    call number_to_date(date_num_temp,date_array,ref_year_meteo)</span>
<span class="w">        </span><span class="c">!    write(unit_logfile,&#39;(a,i4,6i6,f12.4)&#39;) &#39; Date end meteo =   &#39;,t,date_array,date_num_temp</span>
<span class="w">        </span><span class="c">!enddo</span>
<span class="w">        </span><span class="c">!stop</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">var1d_nc_dp</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="w"> </span><span class="p">(</span><span class="n">var1d_nc_dp</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">var2d_nc_dp</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="w"> </span><span class="p">(</span><span class="n">var2d_nc_dp</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">temp_meteo_var3d_nc</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="w"> </span><span class="p">(</span><span class="n">temp_meteo_var3d_nc</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">meteo_var4d_nc</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="w"> </span><span class="p">(</span><span class="n">meteo_var4d_nc</span><span class="p">)</span>

<span class="w">    </span><span class="k">end subroutine </span><span class="n">uEMEP_read_meteo_nc</span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              uEMEP
 was developed by Norwegian Meteorological Institute<br>              &copy; 2024 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
            </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>

    <!-- Bootstrap core JavaScript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>    

    <!-- MathJax JavaScript
             ================================================== -->
             <!-- Placed at the end of the document so the pages load faster -->
        <script type="text/x-mathjax-config">
          MathJax.Hub.Config({
          TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
          jax: ['input/TeX','input/MathML','output/HTML-CSS'],
          extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
          });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

          <script src="../tipuesearch/tipuesearch_content.js"></script>
          <script src="../tipuesearch/tipuesearch_set.js"></script>
          <script src="../tipuesearch/tipuesearch.js"></script>

  </body>
</html>